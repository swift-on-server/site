<section class='introduction'><h1>What’s new in Hummingbird 2?</h1></section><section class='details literature'><p>Hummingbird is a lightweight, flexible HTTP server framework written in Swift. The work on the second major version started last year and the first alpha version was tagged on the 22th of January, 2024. There are quite a lot of significant changes and under the hood improvements. It seems like the new APIs are mostly settled down at this point, so this is a great opportunity to introduce HB2. Let’s dive in.</p><h2 id='Swift%20concurrency'><a href='#Swift%20concurrency'>Swift concurrency</a></h2><p>Hummingbird 2 was built using the modern Swift concurrency APIs. Most of the NIO event loop references are replaced with async / await functions and calls. Structured concurrency is present all around the codebase and the project components, such as <code>Request</code>, are thread safe thanks to the <code><a href='https://swiftinit.org/docs/swift/swift/sendable' target='_blank' rel='external'>Sendable</a></code> conformance.</p><p>Before the async / await feature adoption, some components had a <code>HBAsync</code> prefix. Those are now removed from the v2 library. For example <code>HBAsyncMiddleware</code> is now <code>MiddlewareProtocol</code> or <code>HBAsyncResponder</code> is simply called <code>HTTPResponder</code>.</p><p>It is worth to mention that HB2 is prepared for Swift 6, the project also compiles against the experimental <code>StrictConcurrency=complete</code> feature flag.</p><h2 id='Swift%20service%20lifecycle%20v2'><a href='#Swift%20service%20lifecycle%20v2'>Swift service lifecycle v2</a></h2><p>The <a href='https://github.com/swift-server/swift-service-lifecycle' target='_blank' rel='external'>Swift service lifecycle library</a> provides a clean startup and shutdown mechanism for server applications. Hummingbird 2 uses the latest version of the library including support for graceful shutdown even for custom application services. When Hummingbird is signalled by swift-service-lifecycle to gracefully shut down, any currently running requests continue being handled. New connections and requests will not be accepted, and idle connections are shut down. Once everything’s ready, Hummingbird will shut down completely.</p><h2 id='Hummingbird%20core%20and%20foundation'><a href='#Hummingbird%20core%20and%20foundation'>Hummingbird core and foundation</a></h2><p>The <a href='https://github.com/hummingbird-project/hummingbird-core' target='_blank' rel='external'>HummingbirdCore</a> repository is merged into main repository. The <code>HummingbirdFoundation</code> target was also removed and now all the Foundation extensions are part of the main Hummingbird Swift package target. This makes Hummingbird ergonomically closer to Vapor, allowing users to get started more quickly. This decision is backed by the upcoming move to the new swift-foundation library.</p><h2 id='Jobs%20framework%20updates'><a href='#Jobs%20framework%20updates'>Jobs framework updates</a></h2><p>The HummingbirdJobs framework can be used to push work onto a queue, so that is  processed outside of a request. Job handlers were restructured to use <code><a href='https://swiftinit.org/docs/swift/_concurrency/taskgroup' target='_blank' rel='external'>TaskGroup</a></code> and conform to the <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.0/servicelifecycle/service' target='_blank' rel='external'>Service</a></code> protocol from the Swift service lifecycle framework. A <code>JobQueue</code> can also define it’s own <code>JobID</code> type, which helps when integrating with various database/driver implementations.</p><h2 id='Connection%20pools'><a href='#Connection%20pools'>Connection pools</a></h2><p>The custom connection pool implementation was removed from the framework. Previously, this component offered connection pooling for PostgreSQL. Since <a href='https://github.com/vapor/postgres-nio' target='_blank' rel='external'>PostgresNIO</a> has built-in support, there’s no need for it anymore inside the HB framework.</p><h2 id='HTTP%20improvements'><a href='#HTTP%20improvements'>HTTP improvements</a></h2><p>Hummingbird 2 takes advantage of the brand new <a href='https://github.com/apple/swift-http-types' target='_blank' rel='external'>Swift HTTP Types library</a>. The overall support for HTTP2 and TLS is also improved a lot in the second major version.</p><h2 id='Router%20library'><a href='#Router%20library'>Router library</a></h2><p>Hummingbird 2 features a brand new routing library, based on Swift result builders. This is a standalone project, the old route building mechanism still works, but if you prefer result builders you can try the new method by importing this lib.</p><p>Here’s a little sneak-peak about the usage of the new <code>RouterBuilder</code> object:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>import</span> <span class='xv'>Hummingbird</span><span class='newline'>
</span><span class='xk'>import</span> <span class='xv'>HummingbirdRouter</span><span class='newline'>

</span><span class='xk'>let</span> <span class='xv'>router</span> = <span class='xt'>RouterBuilder</span>(<span class='xv'>context</span>: <span class='xt'>BasicRouterRequestContext</span>.<span class='xk'>self</span>) {<span class='newline'>
</span>    <span class='xt'>TracingMiddleware</span>()<span class='newline'>
</span>    <span class='xv'>Get</span>(<span class='xs'>"test"</span>) { _, <span class='xv'>context</span> <span class='xk'>in</span><span class='newline'>
</span>        <span class='xk'>return</span> <span class='xv'>context</span>.<span class='xv'>endpointPath</span><span class='newline'>
</span>    }<span class='newline'>
</span>    <span class='xv'>Get</span> { _, <span class='xv'>context</span> <span class='xk'>in</span><span class='newline'>
</span>        <span class='xk'>return</span> <span class='xv'>context</span>.<span class='xv'>endpointPath</span><span class='newline'>
</span>    }<span class='newline'>
</span>    <span class='xv'>Post</span>(<span class='xs'>"/test2"</span>) { _, <span class='xv'>context</span> <span class='xk'>in</span><span class='newline'>
</span>        <span class='xk'>return</span> <span class='xv'>context</span>.<span class='xv'>endpointPath</span><span class='newline'>
</span>    }<span class='newline'>
</span>}<span class='newline'>
</span><span class='xk'>let</span> <span class='xv'>app</span> = <span class='xt'>Application</span>(<span class='xv'>responder</span>: <span class='xv'>router</span>)<span class='newline'>
</span><span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>app</span>.<span class='xv'>runService</span>()</code></pre><a rel='ugc' href='https://github.com/swift-on-server/site/blob/main/Snippets/hummingbird-2-routerbuilder.swift' target='_blank' class='source github'><span class='file'>hummingbird-2-routerbuilder.swift</span></a><p>There are more examples available inside the Hummingbird <a href='https://github.com/hummingbird-project/hummingbird/blob/2.x.x/Tests/HummingbirdRouterTests/RouterTests.swift' target='_blank' rel='external'>RouterTests</a> file. If you are curious about the new route builder tool, that’s a good place to get started, since there are no official docs just yet.</p><h2 id='Generic%20request%20context'><a href='#Generic%20request%20context'>Generic request context</a></h2><p>The biggest change to the framework is definitely the introduction of the generic request context. Hummingbird 2.0 separates contextual objects from the <code>Request</code> type and users can define custom properties as custom <code>RequestContext</code> protocol implementations.</p><p>The request context is associated with the reworked <code>Router</code>, which a generic class, featuring a <em>Context</em> type. The <code>BasicRequestContext</code> type is the default <em>Context</em> implementation for the <em>Router</em>. The request decoder and encoder defaults to a JSON-based solution when using the base context. You can provide a custom decoder through a custom router context.</p><p>Let me show you how this new contextual router system works in practice.</p><h2 id='HB2%20example%20project'><a href='#HB2%20example%20project'>HB2 example project</a></h2><p>This article contains a sample project, which you can download from the following <a href='https://github.com/swift-on-server/whats-new-in-hummingbird-2-sample' target='_blank' rel='external'>link</a>.</p><p>You can integrate Hummingbird 2 by adding it as a dependency to your project, using Swift Package Manager.</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xc'>// swift-tools-version:5.9</span><span class='newline'>
</span><span class='xk'>import</span> <span class='xv'>PackageDescription</span><span class='newline'>

</span><span class='xk'>let</span> <span class='xv'>package</span> = <span class='xv'>Package</span>(<span class='newline'>
</span>    <span class='xv'>name</span>: <span class='xs'>"whats-new-in-hummingbird-2-sample"</span>,<span class='newline'>
</span>    <span class='xv'>platforms</span>: [<span class='newline'>
</span>        .<span class='xv'>macOS</span>(.<span class='xv'>v14</span>),<span class='newline'>
</span>    ],<span class='newline'>
</span>    <span class='xv'>dependencies</span>: [<span class='newline'>
</span>        .<span class='xv'>package</span>(<span class='xv'>url</span>: <span class='xs'>"https://github.com/hummingbird-project/hummingbird.git"</span>, <span class='xv'>from</span>: <span class='xs'>"2.0.0-rc.1"</span>),<span class='newline'>
</span>        .<span class='xv'>package</span>(<span class='xv'>url</span>: <span class='xs'>"https://github.com/apple/swift-argument-parser.git"</span>, <span class='xv'>from</span>: <span class='xs'>"1.4.0"</span>),<span class='newline'>
</span>    ],<span class='newline'>
</span>    <span class='xv'>targets</span>: [<span class='newline'>
</span>        .<span class='xv'>executableTarget</span>(<span class='newline'>
</span>            <span class='xv'>name</span>: <span class='xs'>"App"</span>,<span class='newline'>
</span>            <span class='xv'>dependencies</span>: [<span class='newline'>
</span>                .<span class='xv'>product</span>(<span class='xv'>name</span>: <span class='xs'>"ArgumentParser"</span>, <span class='xv'>package</span>: <span class='xs'>"swift-argument-parser"</span>),<span class='newline'>
</span>                .<span class='xv'>product</span>(<span class='xv'>name</span>: <span class='xs'>"Hummingbird"</span>, <span class='xv'>package</span>: <span class='xs'>"hummingbird"</span>),<span class='newline'>
</span>                <span class='xc'>// .product(name: "HummingbirdRouter", package: "hummingbird"),</span><span class='newline'>
</span>            ]<span class='newline'>
</span>        ),<span class='newline'>
</span>        .<span class='xv'>testTarget</span>(<span class='newline'>
</span>            <span class='xv'>name</span>: <span class='xs'>"AppTests"</span>,<span class='newline'>
</span>            <span class='xv'>dependencies</span>: [<span class='newline'>
</span>                .<span class='xv'>target</span>(<span class='xv'>name</span>: <span class='xs'>"App"</span>),<span class='newline'>
</span>                .<span class='xv'>product</span>(<span class='xv'>name</span>: <span class='xs'>"HummingbirdXCT"</span>, <span class='xv'>package</span>: <span class='xs'>"hummingbird"</span>),<span class='newline'>
</span>            ]<span class='newline'>
</span>        ),<span class='newline'>
</span>    ]<span class='newline'>
</span>)</code></pre><p>Here’s how to build a custom decoder to handle different media types on your backend server:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xc'>// 1.</span><span class='newline'>
</span><span class='xk'>struct</span> <span class='xt'>MyRequestDecoder</span>: <span class='xt'>RequestDecoder</span> {<span class='newline'>
</span>    <span class='xk'>func</span> <span class='xv'>decode</span>&lt;<span class='xv'>T</span>&gt;(<span class='newline'>
</span>        _ <span class='xv'>type</span>: <span class='xt'>T</span>.<span class='xk'>Type</span>,<span class='newline'>
</span>        <span class='xv'>from</span> <span class='xv'>request</span>: <span class='xt'>Request</span>,<span class='newline'>
</span>        <span class='xv'>context</span>: <span class='xk'>some</span> <span class='xt'>RequestContext</span><span class='newline'>
</span>    ) <span class='xk'>async</span> <span class='xk'>throws</span> -&gt; <span class='xt'>T</span> <span class='xk'>where</span> <span class='xt'>T</span>: <a class='xt' href='https://swiftinit.org/docs/swift/swift/decodable' target='_blank' rel='external'>Decodable</a> {<span class='newline'>
</span>        <span class='xc'>// 2.</span><span class='newline'>
</span>        <span class='xk'>guard</span> <span class='xk'>let</span> <span class='xv'>header</span> = <span class='xv'>request</span>.<span class='xv'>headers</span><a href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httpfields.subscript(_:)?hash=8MY26' target='_blank' rel='external'>[.</a><a class='xv' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httpfield/name.contenttype' target='_blank' rel='external'>contentType</a>] <span class='xk'>else</span> {<span class='newline'>
</span>            <span class='xk'>throw</span> <span class='xt'>HTTPError</span>(.<a class='xv' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httpresponse/status.badrequest' target='_blank' rel='external'>badRequest</a>)<span class='newline'>
</span>        }<span class='newline'>
</span>        <span class='xc'>// 3.</span><span class='newline'>
</span>        <span class='xk'>guard</span> <span class='xk'>let</span> <span class='xv'>mediaType</span> = <span class='xt'>MediaType</span>(<span class='xv'>from</span>: <span class='xv'>header</span>) <span class='xk'>else</span> {<span class='newline'>
</span>            <span class='xk'>throw</span> <span class='xt'>HTTPError</span>(.<a class='xv' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httpresponse/status.badrequest' target='_blank' rel='external'>badRequest</a>)<span class='newline'>
</span>        }<span class='newline'>
</span>        <span class='xc'>// 4.</span><span class='newline'>
</span>        <span class='xk'>let</span> <span class='xv'>decoder</span>: <span class='xt'>RequestDecoder</span><span class='newline'>
</span>        <span class='xk'>switch</span> <span class='xv'>mediaType</span> {<span class='newline'>
</span>        <span class='xk'>case</span> .<span class='xv'>applicationJson</span>:<span class='newline'>
</span>            <span class='xv'>decoder</span> = <a class='xt' href='https://swiftinit.org/docs/swift/foundation/jsondecoder' target='_blank' rel='external'>JSONDecoder</a>()<span class='newline'>
</span>        <span class='xk'>case</span> .<span class='xv'>applicationUrlEncoded</span>:<span class='newline'>
</span>            <span class='xv'>decoder</span> = <span class='xt'>URLEncodedFormDecoder</span>()<span class='newline'>
</span>        <span class='xk'>default</span>:<span class='newline'>
</span>            <span class='xk'>throw</span> <span class='xt'>HTTPError</span>(.<a class='xv' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httpresponse/status.badrequest' target='_blank' rel='external'>badRequest</a>)<span class='newline'>
</span>        }<span class='newline'>
</span>        <span class='xc'>// 5</span><span class='newline'>
</span>        <span class='xk'>return</span> <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>decoder</span>.<span class='xv'>decode</span>(<span class='newline'>
</span>            <span class='xv'>type</span>,<span class='newline'>
</span>            <span class='xv'>from</span>: <span class='xv'>request</span>,<span class='newline'>
</span>            <span class='xv'>context</span>: <span class='xv'>context</span><span class='newline'>
</span>        )<span class='newline'>
</span>    }<span class='newline'>
</span>}</code></pre><a rel='ugc' href='https://github.com/swift-on-server/site/blob/main/Snippets/hummingbird-2.swift#L6' target='_blank' class='source github'><span class='file'>hummingbird-2.swift</span>:<span class='line'>6</span></a><ol><li><p>Define the custom decoder by implementing the <code>RequestDecoder</code> protocol.</p></li><li><p>Make sure that the incoming request has a <code>Content-Type</code> HTTP header field.</p></li><li><p>Construct a valid <code>MediaType</code> object from the header field.</p></li><li><p>Setup a custom decoder based on the media type.</p></li><li><p>Return the decoded object using the decoder, with the request and the context.</p></li></ol><p>To use the custom decoder, let’s define a custom request context. A request context is a container for the Hummingbird framework to store information needed by the framework. The following snippet demonstrates how to build one using the <em>RequestContext</em> protocol:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xc'>// 1.</span><span class='newline'>
</span><span class='xk'>protocol</span> <span class='xt'>MyRequestContext</span>: <span class='xt'>RequestContext</span> {<span class='newline'>
</span>    <span class='xk'>var</span> <span class='xv'>myValue</span>: <a class='xt' href='https://swiftinit.org/docs/swift/swift/string' target='_blank' rel='external'>String</a>? { <span class='xv'>get</span> <span class='xv'>set</span> }<span class='newline'>
</span>}<span class='newline'>

</span><span class='xc'>// 2.</span><span class='newline'>
</span><span class='xk'>struct</span> <span class='xt'>MyBaseRequestContext</span>: <span class='xt'>MyRequestContext</span> {<span class='newline'>
</span>    <span class='xk'>var</span> <span class='xv'>coreContext</span>: <span class='xt'>CoreRequestContextStorage</span><span class='newline'>

</span>    <span class='xc'>// 3.</span><span class='newline'>
</span>    <span class='xk'>var</span> <span class='xv'>myValue</span>: <a class='xt' href='https://swiftinit.org/docs/swift/swift/string' target='_blank' rel='external'>String</a>?<span class='newline'>

</span>    <span class='xk'>init</span>(<span class='xv'>source</span>: <span class='xt'>Source</span>) {<span class='newline'>
</span>        <span class='xk'>self</span>.<span class='xv'>coreContext</span> = .<span class='xv'>init</span>(<span class='xv'>source</span>: <span class='xv'>source</span>)<span class='newline'>
</span>    }<span class='newline'>

</span>    <span class='xc'>// 4.</span><span class='newline'>
</span>    <span class='xk'>var</span> <span class='xv'>requestDecoder</span>: <span class='xt'>RequestDecoder</span> {<span class='newline'>
</span>        <span class='xt'>MyRequestDecoder</span>()<span class='newline'>
</span>    }<span class='newline'>
</span>}</code></pre><a rel='ugc' href='https://github.com/swift-on-server/site/blob/main/Snippets/hummingbird-2.swift#L41' target='_blank' class='source github'><span class='file'>hummingbird-2.swift</span>:<span class='line'>41</span></a><ol><li><p>Define a custom <code>MyRequestContext</code> protocol using the <em>RequestContext</em> protocol.</p></li><li><p>Implement the <code>MyRequestContext</code> protocol using a <code>MyBaseRequestContext</code> struct.</p></li><li><p>Implement custom properties, configure them using the init method, if needed.</p></li><li><p>Return the custom <code>MyRequestDecoder</code> as a default request decoder implementation.</p></li></ol><p>The <a href='https://github.com/hummingbird-project/hummingbird-auth' target='_blank' rel='external'>HummingbirdAuth</a> library also defines a custom context (<code>AuthRequestContext</code>) in a similar way to store user auth information.</p><p>It is possible to compose multiple protocols such as <em>AuthRequestContext</em> by conforming to all of them. This makes it easy to integrate the context with various libraries. This also allows libraries to provide middleware that accept a custom context as input, or that modify a custom context, to enrich requests. For example, enriching a request by adding the authenticated user.</p><p>Create the application instance using the <code>buildApplication</code> function.</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>func</span> <span class='xv'>buildApplication</span>() <span class='xk'>async</span> <span class='xk'>throws</span> -&gt; <span class='xk'>some</span> <span class='xt'>ApplicationProtocol</span> {<span class='newline'>
</span>    <span class='xc'>// 1.</span><span class='newline'>
</span>    <span class='xk'>let</span> <span class='xv'>router</span> = <span class='xt'>Router</span>(<span class='xv'>context</span>: <span class='xt'>MyBaseRequestContext</span>.<span class='xk'>self</span>)<span class='newline'>

</span>    <span class='xc'>// 2</span><span class='newline'>
</span>    <span class='xv'>router</span>.<span class='xv'>middlewares</span>.<span class='xv'>add</span>(<span class='xt'>LogRequestsMiddleware</span>(.<a class='xv' href='https://swiftinit.org/docs/swift-log/logging/logger/level.info' target='_blank' rel='external'>info</a>))<span class='newline'>
</span>    <span class='xv'>router</span>.<span class='xv'>middlewares</span>.<span class='xv'>add</span>(<span class='xt'>FileMiddleware</span>())<span class='newline'>
</span>    <span class='xv'>router</span>.<span class='xv'>middlewares</span>.<span class='xv'>add</span>(<span class='xt'>CORSMiddleware</span>(<span class='newline'>
</span>        <span class='xv'>allowOrigin</span>: .<span class='xv'>originBased</span>,<span class='newline'>
</span>        <span class='xv'>allowHeaders</span>: [.<a class='xv' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httpfield/name.contenttype' target='_blank' rel='external'>contentType</a>],<span class='newline'>
</span>        <span class='xv'>allowMethods</span>: [.<a class='xv' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httprequest/method.get' target='_blank' rel='external'>get</a>, .<a class='xv' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httprequest/method.post' target='_blank' rel='external'>post</a>, .<a class='xv' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httprequest/method.delete' target='_blank' rel='external'>delete</a>, .<a class='xv' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httprequest/method.patch' target='_blank' rel='external'>patch</a>]<span class='newline'>
</span>    ))<span class='newline'>

</span>    <span class='xc'>// 3</span><span class='newline'>
</span>    <span class='xv'>router</span>.<span class='xv'>get</span>(<span class='xs'>"/health"</span>) { _, _ -&gt; <a class='xt' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httpresponse' target='_blank' rel='external'>HTTPResponse</a>.<a class='xt' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httpresponse/status' target='_blank' rel='external'>Status</a> <span class='xk'>in</span><span class='newline'>
</span>            .<a class='xv' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httpresponse/status.ok' target='_blank' rel='external'>ok</a><span class='newline'>
</span>    }<span class='newline'>

</span>    <span class='xc'>// 4.</span><span class='newline'>
</span>    <span class='xt'>MyController</span>().<span class='xv'>addRoutes</span>(<span class='xv'>to</span>: <span class='xv'>router</span>.<span class='xv'>group</span>(<span class='xs'>"api"</span>))<span class='newline'>

</span>    <span class='xc'>// 5.</span><span class='newline'>
</span>    <span class='xk'>return</span> <span class='xt'>Application</span>(<span class='newline'>
</span>        <span class='xv'>router</span>: <span class='xv'>router</span>,<span class='newline'>
</span>        <span class='xv'>configuration</span>: .<span class='xv'>init</span>(<span class='newline'>
</span>            <span class='xv'>address</span>: .<span class='xv'>hostname</span>(<span class='xs'>"localhost"</span>, <span class='xv'>port</span>: <span class='xn'>8080</span>)<span class='newline'>
</span>        )<span class='newline'>
</span>    )<span class='newline'>
</span>}</code></pre><a rel='ugc' href='https://github.com/swift-on-server/site/blob/main/Snippets/hummingbird-2.swift#L106' target='_blank' class='source github'><span class='file'>hummingbird-2.swift</span>:<span class='line'>106</span></a><ol><li><p>Setup the router using the <code>MyBaseRequestContext</code> type as a custom context.</p></li><li><p>Add middlewares to the router, HB2 has middlewares on the router instead of the app</p></li><li><p>Setup a basic health route on the router, simply return with a HTTP status code</p></li><li><p>Add routes using the custom controller to the <code>api</code> route group</p></li><li><p>Build the <em>Application</em> instance using the router and the configuration</p></li></ol><p>Inside the main entrypoint you can start the server by calling the <code>Application.runService</code> method:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>import</span> <span class='xv'>ArgumentParser</span><span class='newline'>
</span><span class='xk'>import</span> <span class='xv'>Hummingbird</span><span class='newline'>

</span><span class='xa'>@main</span><span class='newline'>
</span><span class='xk'>struct</span> <span class='xt'>HummingbirdArguments</span>: <a class='xt' href='https://swiftinit.org/hist/swift-argument-parser:1.4.0/argumentparser/asyncparsablecommand' target='_blank' rel='external'>AsyncParsableCommand</a> {<span class='newline'>
</span>    <span class='xk'>func</span> <span class='xv'>run</span>() <span class='xk'>async</span> <span class='xk'>throws</span> {<span class='newline'>
</span>        <span class='xk'>let</span> <span class='xv'>app</span> = <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>buildApplication</span>()<span class='newline'>
</span>        <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>app</span>.<span class='xv'>runService</span>()<span class='newline'>
</span>    }<span class='newline'>
</span>}</code></pre><a rel='ugc' href='https://github.com/swift-on-server/site/blob/main/Snippets/hummingbird-2.swift#L137' target='_blank' class='source github'><span class='file'>hummingbird-2.swift</span>:<span class='line'>137</span></a><p>The route handlers in the <code>MyController</code> struct can access of the custom context type.</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>struct</span> <span class='xt'>MyController</span>&lt;<span class='xt'>Context</span>: <span class='xt'>MyRequestContext</span>&gt; {<span class='newline'>
</span>    <span class='xc'>// 1.</span><span class='newline'>
</span>    <span class='xk'>func</span> <span class='xv'>addRoutes</span>(<span class='newline'>
</span>        <span class='xv'>to</span> <span class='xv'>group</span>: <span class='xt'>RouterGroup</span>&lt;<span class='xt'>Context</span>&gt;<span class='newline'>
</span>    ) {<span class='newline'>
</span>        <span class='xv'>group</span><span class='newline'>
</span>            .<span class='xv'>get</span>(<span class='xv'>use</span>: <span class='xv'>list</span>)<span class='newline'>
</span>            .<span class='xv'>post</span>(<span class='xv'>use</span>: <span class='xv'>create</span>)<span class='newline'>
</span>    }<span class='newline'>

</span>    <span class='xc'>// 2.</span><span class='newline'>
</span>    <span class='xa'>@Sendable</span><span class='newline'>
</span>    <span class='xk'>func</span> <span class='xv'>list</span>(<span class='newline'>
</span>        _ <span class='xv'>request</span>: <span class='xt'>Request</span>,<span class='newline'>
</span>        <span class='xv'>context</span>: <span class='xt'>Context</span><span class='newline'>
</span>    ) <span class='xk'>async</span> <span class='xk'>throws</span> -&gt; [<span class='xt'>MyModel</span>] {<span class='newline'>
</span>        [<span class='newline'>
</span>            .<span class='xv'>init</span>(<span class='xv'>title</span>: <span class='xs'>"foo"</span>),<span class='newline'>
</span>            .<span class='xv'>init</span>(<span class='xv'>title</span>: <span class='xs'>"bar"</span>),<span class='newline'>
</span>            .<span class='xv'>init</span>(<span class='xv'>title</span>: <span class='xs'>"baz"</span>),<span class='newline'>
</span>        ]<span class='newline'>
</span>    }<span class='newline'>

</span>    <span class='xa'>@Sendable</span><span class='newline'>
</span>    <span class='xk'>func</span> <span class='xv'>create</span>(<span class='newline'>
</span>        _ <span class='xv'>request</span>: <span class='xt'>Request</span>,<span class='newline'>
</span>        <span class='xv'>context</span>: <span class='xt'>Context</span><span class='newline'>
</span>    ) <span class='xk'>async</span> <span class='xk'>throws</span> -&gt; <span class='xt'>EditedResponse</span>&lt;<span class='xt'>MyModel</span>&gt; {<span class='newline'>
</span>        <span class='xc'>// 3.</span><span class='newline'>
</span>        <span class='xc'>// context.myValue</span><span class='newline'>
</span>        <span class='xk'>let</span> <span class='xv'>input</span> = <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>request</span>.<span class='xv'>decode</span>(<span class='newline'>
</span>            <span class='xv'>as</span>: <span class='xt'>MyModel</span>.<span class='xk'>self</span>,<span class='newline'>
</span>            <span class='xv'>context</span>: <span class='xv'>context</span><span class='newline'>
</span>        )<span class='newline'>
</span>        <span class='xk'>return</span> .<span class='xv'>init</span>(<span class='xv'>status</span>: .<a class='xv' href='https://swiftinit.org/hist/swift-http-types:1.2.0/httptypes/httpresponse/status.created' target='_blank' rel='external'>created</a>, <span class='xv'>response</span>: <span class='xv'>input</span>)<span class='newline'>
</span>    }<span class='newline'>
</span>}</code></pre><a rel='ugc' href='https://github.com/swift-on-server/site/blob/main/Snippets/hummingbird-2.swift#L67' target='_blank' class='source github'><span class='file'>hummingbird-2.swift</span>:<span class='line'>67</span></a><ol><li><p>Register route handlers using the router group</p></li><li><p>Hummingbird is thread-safe, so every route handler should be marked  with <code>@Sendable</code> to propagate these thread-safety checks.</p></li><li><p>It is possible to access both the request and the context in each route handler.</p></li></ol><p>As you can see there are quite a lot of changes in the latest version of the Hummingbird framework. The final release date is still unknown, but it is expected to happen within a few months, after the alpha &amp; beta period ends.</p><p>If have questions about Hummingbird, feel free to join the following <a href='https://discord.gg/fkN7FC7QJk' target='_blank' rel='external nofollow noopener ugc'>Discord server</a>. You can also get some inspiration from the official <a href='https://github.com/hummingbird-project/hummingbird-examples' target='_blank' rel='external'>Hummingbird examples</a> repository.</p></section><div style='display: none;' id='ss:tooltips'><a href='/docs/swift/swift/sendable'><pre><code><span class='xk'>protocol</span> <span class='xv'>Sendable</span></code></pre><p>A type whose values can safely be passed across concurrency domains by copying.</p></a><a href='/docs/swift/_concurrency/taskgroup'><pre><code><span class='xa'>@frozen</span> <span class='xk'>struct</span> <span class='xv'>TaskGroup</span>&lt;<span class='xu'>ChildTaskResult</span>&gt; <span class='xk'>where</span> <span class='xt'>ChildTaskResult</span> : <span class='xt'>Sendable</span></code></pre><p>A group that contains dynamically created child tasks.</p></a><a href='/hist/swift-service-lifecycle:2.6.0/servicelifecycle/service'><pre><code><span class='xk'>protocol</span> <span class='xv'>Service</span> : <span class='xt'>Sendable</span></code></pre><p>This is the basic protocol that a service has to implement.</p></a><a href='/docs/swift/swift/decodable'><pre><code><span class='xk'>protocol</span> <span class='xv'>Decodable</span></code></pre><p>A type that can decode itself from an external representation.</p></a><a href='/hist/swift-http-types:1.2.0/httptypes/httpfields.subscript(_:)?hash=8MY26'><pre><code><span class='xk'>subscript</span>(<span class='xi'></span><span class='xv'>name</span>: <span class='xt'>HTTPField</span>.<span class='xt'>Name</span><wbr>) -&gt; <span class='xt'>String</span>? { <span class='xk'>get</span> <span class='xk'>set</span> }</code></pre><p>Access the field value string by name.</p></a><a href='/hist/swift-http-types:1.2.0/httptypes/httpfield/name.contenttype'><pre><code><span class='xk'>static</span> <span class='xk'>var</span> <span class='xv'>contentType</span>: <span class='xt'>HTTPField</span>.<span class='xt'>Name</span> { <span class='xk'>get</span> }</code></pre><p>Content-Type</p></a><a href='/hist/swift-http-types:1.2.0/httptypes/httpresponse/status.badrequest'><pre><code><span class='xk'>static</span> <span class='xk'>var</span> <span class='xv'>badRequest</span>: <span class='xt'>HTTPResponse</span>.<span class='xt'>Status</span> { <span class='xk'>get</span> }</code></pre><p>400 Bad Request</p></a><a href='/docs/swift/foundation/jsondecoder'><pre><code><span class='xk'>class</span> <span class='xv'>JSONDecoder</span></code></pre><p><code>JSONDecoder</code> facilitates the decoding of JSON into semantic <code>Decodable</code> types.</p></a><a href='/docs/swift/swift/string'><pre><code><span class='xa'>@frozen</span> <span class='xk'>struct</span> <span class='xv'>String</span></code></pre><p>A Unicode string value that is a collection of characters.</p></a><a href='/docs/swift-log/logging/logger/level.info'><pre><code><span class='xk'>case</span> <span class='xv'>info</span></code></pre><p>Appropriate for informational messages.</p></a><a href='/hist/swift-http-types:1.2.0/httptypes/httprequest/method.get'><pre><code><span class='xk'>static</span> <span class='xk'>var</span> <span class='xv'>get</span>: <span class='xt'>HTTPRequest</span>.<span class='xt'>Method</span> { <span class='xk'>get</span> }</code></pre><p>GET</p></a><a href='/hist/swift-http-types:1.2.0/httptypes/httprequest/method.post'><pre><code><span class='xk'>static</span> <span class='xk'>var</span> <span class='xv'>post</span>: <span class='xt'>HTTPRequest</span>.<span class='xt'>Method</span> { <span class='xk'>get</span> }</code></pre><p>POST</p></a><a href='/hist/swift-http-types:1.2.0/httptypes/httprequest/method.delete'><pre><code><span class='xk'>static</span> <span class='xk'>var</span> <span class='xv'>delete</span>: <span class='xt'>HTTPRequest</span>.<span class='xt'>Method</span> { <span class='xk'>get</span> }</code></pre><p>DELETE</p></a><a href='/hist/swift-http-types:1.2.0/httptypes/httprequest/method.patch'><pre><code><span class='xk'>static</span> <span class='xk'>var</span> <span class='xv'>patch</span>: <span class='xt'>HTTPRequest</span>.<span class='xt'>Method</span> { <span class='xk'>get</span> }</code></pre><p>PATCH</p></a><a href='/hist/swift-http-types:1.2.0/httptypes/httpresponse'><pre><code><span class='xk'>struct</span> <span class='xv'>HTTPResponse</span></code></pre><p>An HTTP response message consisting of the “:status” pseudo header field and header fields.</p></a><a href='/hist/swift-http-types:1.2.0/httptypes/httpresponse/status'><pre><code><span class='xk'>struct</span> <span class='xv'>Status</span></code></pre><p>The response status consisting of a 3-digit status code and a reason phrase. The reason phrase is ignored by modern HTTP versions.</p></a><a href='/hist/swift-http-types:1.2.0/httptypes/httpresponse/status.ok'><pre><code><span class='xk'>static</span> <span class='xk'>var</span> <span class='xv'>ok</span>: <span class='xt'>HTTPResponse</span>.<span class='xt'>Status</span> { <span class='xk'>get</span> }</code></pre><p>200 OK</p></a><a href='/hist/swift-argument-parser:1.4.0/argumentparser/asyncparsablecommand'><pre><code><span class='xk'>protocol</span> <span class='xv'>AsyncParsableCommand</span> : <span class='xt'>ParsableCommand</span></code></pre><p>A type that can be executed asynchronously, as part of a nested tree of commands.</p></a><a href='/hist/swift-http-types:1.2.0/httptypes/httpresponse/status.created'><pre><code><span class='xk'>static</span> <span class='xk'>var</span> <span class='xv'>created</span>: <span class='xt'>HTTPResponse</span>.<span class='xt'>Status</span> { <span class='xk'>get</span> }</code></pre><p>201 Created</p></a></div>