<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://swiftonserver.com/introduction-to-swift-service-lifecycle/">
    <link rel="prev" href="https://swiftonserver.com/templating-with-swift-mustache/">
    <link rel="next" href="https://swiftonserver.com/websockets-tutorial-using-swift-and-hummingbird/">

    <title>Introduction to Swift Service Lifecycle - Swift on server</title>
    <meta name="description" content="This article offers practical examples to introduce the Swift Service Lifecycle library.">

    <meta property="og:url" content="https://swiftonserver.com/introduction-to-swift-service-lifecycle/">
    <meta property="og:title" content="Introduction to Swift Service Lifecycle - Swift on server">
    <meta property="og:description" content="This article offers practical examples to introduce the Swift Service Lifecycle library.">
    <meta property="og:image" content="https://swiftonserver.com/assets/introduction-to-swift-service-lifecycle/cover.jpg" />

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Introduction to Swift Service Lifecycle - Swift on server">
    <meta name="twitter:description" content="This article offers practical examples to introduce the Swift Service Lifecycle library.">
    <meta name="twitter:image" content="https://swiftonserver.com/assets/introduction-to-swift-service-lifecycle/cover.jpg">

    <link rel="stylesheet" href="https://swiftonserver.com/css/modern-normalize.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/modern-base.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/variables.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/base.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/grid.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/navigation.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/footer.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/syntax.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/style.css">

    

    <link rel="shortcut icon" href="https://swiftonserver.com/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://swiftonserver.com/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="https://swiftonserver.com/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="https://swiftonserver.com/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://swiftonserver.com/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://swiftonserver.com/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://swiftonserver.com/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://swiftonserver.com/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://swiftonserver.com/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://swiftonserver.com/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://swiftonserver.com/images/icons/apple-touch-icon-180x180.png">

    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
        media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
        media="(prefers-color-scheme: dark)"
    >

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
          const container = document.querySelector("div#swiftinit-tooltips");
          if (container !== null) {
              container.querySelectorAll('pre code').forEach((el) => {
                  el.classList.add('nohighlight');
              });
          }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
          document.querySelectorAll('section pre code:not(.language-swift').forEach((el) => {
              hljs.highlightElement(el);
          });
        });
    </script>

    <script defer data-domain="swiftonserver.com" src="https://plausible.io/js/script.js"></script>

</head>

<body>
    <div id="site-container">

    <header id="navigation">
        <a href="/">
            <figure>
                <picture>
                    <source
                        srcset="https://swiftonserver.com/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        src="https://swiftonserver.com/images/logos/logo.png"
                        alt="Logo of Swift on server"
                        title="Swift on server"
                    >
                </picture>
            </figure>
        </a>
        <nav>
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="https://swiftonserver.com/posts/page/1/">Posts</a>
            <a href="https://swiftonserver.com/tags/">Tags</a>
            <a href="https://swiftonserver.com/authors/">Authors</a>
            <a href="https://swiftonserver.com/newsletter/">Newsletter</a>
            </div>
        </nav>
    </header>

    <main id="page-container">
    
    <div class="article-with-toc">
        <div>
            <article class="post">
                <div class="meta">
                    <time datetime="2024-05-22">2024-05-22</time>
                     &middot; <span class="reading-time">7 min read</span>
                    
                </div>
                <section>
                
                <section class='introduction'><h1>Introduction to Swift Service Lifecycle</h1></section><section class='details literature'><p>The <a href='https://github.com/swift-server/swift-service-lifecycle' target='_blank' rel='external'>Swift Service Lifecycle</a> library helps to manage application lifecycle by providing a unified start and stop mechanism. It also features a signal-based shutdown hook, allowing users to gracefully shut down and clean up resources before the application exits.</p><h2 id='A%20basic%20service%20example'><a href='#A%20basic%20service%20example'>A basic service example</a></h2><p>First, the Swift Service Lifecycle package needs to be added to the project. This can be done by modifying the <code>Package.swift</code> file as follows:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xc'>// swift-tools-version: 5.10</span><span class='newline'>
</span><span class='xk'>import</span> <span class='xv'>PackageDescription</span><span class='newline'>

</span><span class='xk'>let</span> <span class='xv'>package</span> = <span class='xv'>Package</span>(<span class='newline'>
</span>    <span class='xv'>name</span>: <span class='xs'>"Example"</span>,<span class='newline'>
</span>    <span class='xv'>platforms</span>: [<span class='newline'>
</span>        .<span class='xv'>macOS</span>(.<span class='xv'>v14</span>),<span class='newline'>
</span>    ],<span class='newline'>
</span>    <span class='xv'>dependencies</span>: [<span class='newline'>
</span>        .<span class='xv'>package</span>(<span class='xv'>url</span>: <span class='xs'>"https://github.com/swift-server/swift-service-lifecycle.git"</span>, <span class='xv'>from</span>: <span class='xs'>"2.5.0"</span>),<span class='newline'>
</span>    ],<span class='newline'>
</span>    <span class='xv'>targets</span>: [<span class='newline'>
</span>        .<span class='xv'>executableTarget</span>(<span class='newline'>
</span>            <span class='xv'>name</span>: <span class='xs'>"Example"</span>,<span class='newline'>
</span>            <span class='xv'>dependencies</span>: [<span class='newline'>
</span>                .<span class='xv'>product</span>(<span class='xv'>name</span>: <span class='xs'>"ServiceLifecycle"</span>, <span class='xv'>package</span>: <span class='xs'>"swift-service-lifecycle"</span>),<span class='newline'>
</span>            ]<span class='newline'>
</span>        ),<span class='newline'>
</span>    ]<span class='newline'>
</span>)</code></pre><p>Before the actual implementation, it is important to understand the basic building blocks of the Service Lifecycle library.</p><p>Long-running work should be modeled as services that implement the <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle/service' target='_blank' rel='external'>Service</a></code> protocol. This protocol requires only one function: a simple asynchronous throwing <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle/service.run' target='_blank' rel='external'>run</a></code> method.</p><p>The <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle/servicegroup' target='_blank' rel='external'>ServiceGroup</a></code> is used to orchestrate multiple services. A child task is spawned for each service, and the respective run method is called in the child task. Additionally, signal listeners are set up for the configured signals, triggering a graceful shutdown for each service.</p><p>A <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle/servicegroup' target='_blank' rel='external'>ServiceGroup</a></code> manages the execution of multiple services, handles signal processing, and signals graceful shutdowns to the services.</p><p>While a service is typically a long-running task, it can also be a simple task that returns immediately. By default, if one service returns or throws an error, the entire group is canceled. This behavior can be customized by providing a custom <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle/servicegroupconfiguration/serviceconfiguration.successterminationbehavior' target='_blank' rel='external'>successTerminationBehavior</a></code> parameter for the service group, as detailed <a href='https://swiftpackageindex.com/swift-server/swift-service-lifecycle/main/documentation/servicelifecycle/how-to-adopt-servicelifecycle-in-applications#Customizing-the-behavior-when-a-service-returns-or-throws' target='_blank' rel='external nofollow noopener ugc'>here</a>.</p><p>The following example illustrates a simple service and a service group with customized termination behavior:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>import</span> <span class='xv'>ServiceLifecycle</span><span class='newline'>

</span><span class='xk'>struct</span> <span class='xv'>BasicService</span>: <span class='xt'>Service</span> {<span class='newline'>
</span>    <span class='xc'>// 1.</span><span class='newline'>
</span>    <span class='xk'>func</span> <span class='xv'>run</span>() <span class='xk'>async</span> <span class='xk'>throws</span> {<span class='newline'>
</span>        <span class='xv'>print</span>(<span class='xs'>"Hello, basic service!"</span>)<span class='newline'>
</span>    }<span class='newline'>
</span>}<span class='newline'>

</span><span class='xa'>@main</span><span class='newline'>
</span><span class='xk'>struct</span> <span class='xv'>Application</span> {<span class='newline'>

</span>    <span class='xk'>static</span> <span class='xk'>func</span> <span class='xv'>main</span>() <span class='xk'>async</span> <span class='xk'>throws</span> {<span class='newline'>
</span>        <span class='xc'>// 2.</span><span class='newline'>
</span>        <span class='xk'>let</span> <span class='xv'>service</span> = <span class='xv'>BasicService</span>()<span class='newline'>

</span>        <span class='xc'>// 3.</span><span class='newline'>
</span>        <span class='xk'>let</span> <span class='xv'>serviceGroup</span> = <span class='xv'>ServiceGroup</span>(<span class='newline'>
</span>            <span class='xv'>configuration</span>: .<span class='xk'>init</span>(<span class='newline'>
</span>                <span class='xv'>services</span>: [<span class='newline'>
</span>                    <span class='xc'>// 4.</span><span class='newline'>
</span>                    .<span class='xk'>init</span>(<span class='newline'>
</span>                        <span class='xv'>service</span>: <span class='xv'>service</span>,<span class='newline'>
</span>                        <span class='xv'>successTerminationBehavior</span>: .<span class='xv'>ignore</span>,<span class='newline'>
</span>                    )<span class='newline'>
</span>                ],<span class='newline'>
</span>                <span class='xv'>logger</span>: .<span class='xk'>init</span>(<span class='newline'>
</span>                    <span class='xv'>label</span>: <span class='xs'>"service-group"</span><span class='newline'>
</span>                )<span class='newline'>
</span>            )<span class='newline'>
</span>        )<span class='newline'>
</span>        <span class='xc'>// 5.</span><span class='newline'>
</span>        <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>serviceGroup</span>.<span class='xv'>run</span>()<span class='newline'>
</span>    }<span class='newline'>
</span>}</code></pre><ol><li><p>This is the implementation of the run function required by the <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle/service' target='_blank' rel='external'>Service</a></code> protocol.</p></li><li><p>The <code>BasicService</code> instance is created, it’s going to be used in the group.</p></li><li><p>A <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle/servicegroup' target='_blank' rel='external'>ServiceGroup</a></code> is initialized with the service instances, using a custom configuration.</p></li><li><p>The service group configuration ignores service termination behavior for the basic service.</p></li><li><p>The <code>serviceGroup.run()</code> method is called to run the service group, with the configured services.</p></li></ol><h2 id='Graceful%20shutdown%20and%20cancellation%20signals'><a href='#Graceful%20shutdown%20and%20cancellation%20signals'>Graceful shutdown and cancellation signals</a></h2><p>Rather than setting a custom termination behavior, it is also possible to wait for a cancellation signal and then shut down service resources when that event occurs. The <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle.gracefulshutdown' target='_blank' rel='external'>gracefulShutdown</a></code> function is designed to suspend the caller until a graceful shutdown is initiated.</p><p>A graceful shutdown is when an application closes down in an orderly way. Instead of stopping suddenly, it finishes its current tasks and cleans up resources like open files or network connections. This matters because it prevents data loss, avoids corruption, and ensures that the system remains stable and reliable. By shutting down gracefully, applications can stop safely without causing problems for users or other systems they interact with.</p><p>The following code snippet illustrates this approach:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>import</span> <span class='xv'>ServiceLifecycle</span><span class='newline'>

</span><span class='xk'>struct</span> <span class='xv'>BasicService</span>: <span class='xt'>Service</span> {<span class='newline'>

</span>    <span class='xk'>func</span> <span class='xv'>run</span>() <span class='xk'>async</span> <span class='xk'>throws</span> {<span class='newline'>
</span>        <span class='xv'>print</span>(<span class='xs'>"Start - basic service!"</span>)<span class='newline'>

</span>        <span class='xc'>// 1.</span><span class='newline'>
</span>        <span class='xk'>try</span>? <span class='xk'>await</span> <span class='xv'>gracefulShutdown</span>()<span class='newline'>

</span>        <span class='xv'>print</span>(<span class='xs'>"Shutdown - basic service!"</span>)<span class='newline'>
</span>    }<span class='newline'>
</span>}<span class='newline'>

</span><span class='xa'>@main</span><span class='newline'>
</span><span class='xk'>struct</span> <span class='xv'>Application</span> {<span class='newline'>

</span>    <span class='xk'>static</span> <span class='xk'>func</span> <span class='xv'>main</span>() <span class='xk'>async</span> <span class='xk'>throws</span> {<span class='newline'>
</span>        <span class='xk'>let</span> <span class='xv'>service</span> = <span class='xv'>BasicService</span>()<span class='newline'>

</span>        <span class='xk'>let</span> <span class='xv'>serviceGroup</span> = <span class='xv'>ServiceGroup</span>(<span class='newline'>
</span>            <span class='xv'>configuration</span>: .<span class='xk'>init</span>(<span class='newline'>
</span>                <span class='xv'>services</span>: [<span class='newline'>
</span>                    <span class='xc'>// 2.</span><span class='newline'>
</span>                    .<span class='xk'>init</span>(<span class='xv'>service</span>: <span class='xv'>service</span>)<span class='newline'>
</span>                ],<span class='newline'>
</span>                <span class='xc'>// 3.</span><span class='newline'>
</span>                <span class='xv'>cancellationSignals</span>: [.<span class='xv'>sigterm</span>, .<span class='xv'>sigint</span>],<span class='newline'>
</span>                <span class='xv'>logger</span>: .<span class='xk'>init</span>(<span class='newline'>
</span>                    <span class='xv'>label</span>: <span class='xs'>"service-group"</span><span class='newline'>
</span>                )<span class='newline'>
</span>            )<span class='newline'>
</span>        )<span class='newline'>
</span>        <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>serviceGroup</span>.<span class='xv'>run</span>()<span class='newline'>
</span>    }<span class='newline'>
</span>}</code></pre><ol><li><p>Ignore cancellation error, waits for the service until it’s cancelled</p></li><li><p>Configure the service using the default success termination behavior</p></li><li><p>Set the cancellation signals to <code>SIGTERM</code> &amp; <code>SIGINT</code></p></li></ol><p>Run the application from the command line with the following command:</p><pre class='snippet'><code class='language-sh'><span class='newline'></span>swift run</code></pre><p>To halt execution and send a <code>SIGINT</code> signal to the application, press <code>CTRL+C</code>. Any code following the <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle.gracefulshutdown' target='_blank' rel='external'>gracefulShutdown</a></code> function call within the run method will be executed upon receiving any of the cancellation signals.</p><h2 id='Service%20composition'><a href='#Service%20composition'>Service composition</a></h2><p>It’s feasible to utilize one service within another. For instance, we could create an asynchronous HTTP client-based service, potentially with a pool of HTTP clients. The provided code snippet demonstrates this concept:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>import</span> <span class='xv'>ServiceLifecycle</span><span class='newline'>
</span><span class='xk'>import</span> <span class='xv'>AsyncHTTPClient</span><span class='newline'>

</span><span class='xc'>// 1.</span><span class='newline'>
</span><span class='xk'>actor</span> <span class='xv'>AsyncHTTPClientService</span>: <span class='xt'>Service</span> {<span class='newline'>

</span>    <span class='xk'>var</span> <span class='xv'>httpClient</span>: <span class='xt'>HTTPClient</span><span class='newline'>

</span>    <span class='xk'>init</span>() {<span class='newline'>
</span>        <span class='xk'>self</span>.<span class='xv'>httpClient</span> = .<span class='xk'>init</span>(<span class='newline'>
</span>            <span class='xv'>eventLoopGroupProvider</span>: .<span class='xv'>singleton</span><span class='newline'>
</span>        )<span class='newline'>
</span>    }<span class='newline'>

</span>    <span class='xk'>func</span> <span class='xv'>run</span>() <span class='xk'>async</span> <span class='xk'>throws</span> {<span class='newline'>
</span>        <span class='xk'>try</span>? <span class='xk'>await</span> <span class='xv'>gracefulShutdown</span>()<span class='newline'>

</span>        <span class='xv'>print</span>(<span class='xs'>"Shutting down http client service..."</span>)<span class='newline'>
</span>        <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>httpClient</span>.<span class='xv'>shutdown</span>()<span class='newline'>
</span>    }<span class='newline'>
</span>}<span class='newline'>

</span><span class='xk'>actor</span> <span class='xv'>PingService</span>: <span class='xt'>Service</span> {<span class='newline'>

</span>    <span class='xk'>let</span> <span class='xv'>httpClientService</span>: <span class='xt'>AsyncHTTPClientService</span><span class='newline'>

</span>    <span class='xc'>// 2.</span><span class='newline'>
</span>    <span class='xk'>init</span>(<span class='xv'>httpClientService</span>: <span class='xt'>AsyncHTTPClientService</span>) {<span class='newline'>
</span>        <span class='xk'>self</span>.<span class='xv'>httpClientService</span> = <span class='xv'>httpClientService</span><span class='newline'>
</span>    }<span class='newline'>

</span>    <span class='xk'>func</span> <span class='xv'>run</span>() <span class='xk'>async</span> <span class='xk'>throws</span> {<span class='newline'>
</span>        <span class='xc'>// 3.</span><span class='newline'>
</span>        <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>withGracefulShutdownHandler</span> {<span class='newline'>
</span>            <span class='xk'>var</span> <span class='xv'>i</span> = <span class='xn'>0</span><span class='newline'>
</span>            <span class='xc'>// 4.</span><span class='newline'>
</span>            <span class='xk'>repeat</span> {<span class='newline'>
</span>                <span class='xv'>print</span>(<span class='xs'>"Ping #</span>\(<span class='xv'>i</span>)<span class='xs'> - apple.com"</span>)<span class='newline'>

</span>                <span class='xk'>let</span> <span class='xv'>request</span> = <span class='xv'>HTTPClientRequest</span>(<span class='newline'>
</span>                    <span class='xv'>url</span>: <span class='xs'>"https://apple.com/"</span><span class='newline'>
</span>                )<span class='newline'>

</span>                <span class='xc'>// 5.</span><span class='newline'>
</span>                <span class='xk'>let</span> <span class='xv'>response</span> = <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>httpClientService</span>.<span class='xv'>httpClient</span>.<span class='xv'>execute</span>(<span class='newline'>
</span>                    <span class='xv'>request</span>,<span class='newline'>
</span>                    <span class='xv'>timeout</span>: .<span class='xv'>seconds</span>(<span class='xn'>1</span>)<span class='newline'>
</span>                )<span class='newline'>

</span>                <span class='xk'>if</span> <span class='xv'>response</span>.<span class='xv'>status</span> <span class='xo'>==</span> .<span class='xv'>ok</span> {<span class='newline'>
</span>                    <span class='xv'>print</span>(<span class='xs'>"Ping #</span>\(<span class='xv'>i</span>)<span class='xs'> - ok"</span>)<span class='newline'>
</span>                }<span class='newline'>
</span>                <span class='xk'>else</span> {<span class='newline'>
</span>                    <span class='xv'>print</span>(<span class='xs'>"Ping #</span>\(<span class='xv'>i</span>)<span class='xs'> - error"</span>)<span class='newline'>
</span>                }<span class='newline'>

</span>                <span class='xc'>// 6.</span><span class='newline'>
</span>                <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>Task</span>.<span class='xv'>sleep</span>(<span class='xv'>for</span>: .<span class='xv'>seconds</span>(<span class='xn'>1</span>))<span class='newline'>
</span>                <span class='xv'>i</span> <span class='xo'>+=</span> <span class='xn'>1</span><span class='newline'>
</span>            } <span class='xk'>while</span> <span class='xv'>i</span> <span class='xo'>&lt;</span> <span class='xn'>2</span><span class='newline'>
</span>        } <span class='xv'>onGracefulShutdown</span>: {<span class='newline'>
</span>            <span class='xc'>// 7.</span><span class='newline'>
</span>            <span class='xv'>print</span>(<span class='xs'>"Shutting down ping service..."</span>)<span class='newline'>
</span>        }<span class='newline'>
</span>    }<span class='newline'>
</span>}<span class='newline'>

</span><span class='xa'>@main</span><span class='newline'>
</span><span class='xk'>struct</span> <span class='xv'>Application</span> {<span class='newline'>

</span>    <span class='xk'>static</span> <span class='xk'>func</span> <span class='xv'>main</span>() <span class='xk'>async</span> <span class='xk'>throws</span> {<span class='newline'>
</span>        <span class='xc'>// 8.</span><span class='newline'>
</span>        <span class='xk'>let</span> <span class='xv'>httpClientService</span> = <span class='xv'>AsyncHTTPClientService</span>()<span class='newline'>
</span>        <span class='xk'>let</span> <span class='xv'>pingService</span> = <span class='xv'>PingService</span>(<span class='xv'>httpClientService</span>: <span class='xv'>httpClientService</span>)<span class='newline'>

</span>        <span class='xc'>// 9.</span><span class='newline'>
</span>        <span class='xk'>let</span> <span class='xv'>serviceGroup</span> = <span class='xv'>ServiceGroup</span>(<span class='newline'>
</span>            <span class='xv'>configuration</span>: .<span class='xk'>init</span>(<span class='newline'>
</span>                <span class='xv'>services</span>: [<span class='newline'>
</span>                    .<span class='xk'>init</span>(<span class='newline'>
</span>                        <span class='xv'>service</span>: <span class='xv'>httpClientService</span>,<span class='newline'>
</span>                        <span class='xv'>successTerminationBehavior</span>: .<span class='xv'>ignore</span>,<span class='newline'>
</span>                        <span class='xv'>failureTerminationBehavior</span>: .<span class='xv'>gracefullyShutdownGroup</span><span class='newline'>
</span>                    ),<span class='newline'>
</span>                    .<span class='xk'>init</span>(<span class='newline'>
</span>                        <span class='xv'>service</span>: <span class='xv'>pingService</span>,<span class='newline'>
</span>                        <span class='xv'>successTerminationBehavior</span>: .<span class='xv'>gracefullyShutdownGroup</span>,<span class='newline'>
</span>                        <span class='xv'>failureTerminationBehavior</span>: .<span class='xv'>gracefullyShutdownGroup</span><span class='newline'>
</span>                    ),<span class='newline'>
</span>                ],<span class='newline'>
</span>                <span class='xv'>logger</span>: .<span class='xk'>init</span>(<span class='xv'>label</span>: <span class='xs'>"service-group"</span>)<span class='newline'>
</span>            )<span class='newline'>
</span>        )<span class='newline'>

</span>        <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>serviceGroup</span>.<span class='xv'>run</span>()<span class='newline'>
</span>    }<span class='newline'>
</span>}</code></pre><ol><li><p>Defines an <code>AsyncHTTPClientService</code> actor that initializes an HTTP client and implements the run method to handle graceful shutdown by shutting down the HTTP client.</p></li><li><p>Defines a <code>PingService</code> actor that relies on the <code>AsyncHTTPClientService</code> for making HTTP requests.</p></li><li><p>Uses <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle.withgracefulshutdownhandler(isolation:operation:ongracefulshutdown:)' target='_blank' rel='external'>withGracefulShutdownHandler(isolation:operation:onGracefulShutdown:)</a></code> to handle graceful shutdown within the <code>PingService</code> actor’s run method.</p></li><li><p>Initiates a loop for sending HTTP requests to apple.com and prints the result.</p></li><li><p>Executes an HTTP request asynchronously using the AsyncHTTPClientService and handles the response.</p></li><li><p>Delays execution for one second before the next iteration of the loop.</p></li><li><p>Defines a closure to be executed on graceful shutdown within the <code>PingService</code> actor.</p></li><li><p>In the <code>Application</code> struct’s main function, initializes the <code>AsyncHTTPClientService</code> and <code>PingService</code>, and creates a <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle/servicegroup' target='_blank' rel='external'>ServiceGroup</a></code> to manage their lifecycles.</p></li><li><p>Configures the <code><a href='https://swiftinit.org/hist/swift-service-lifecycle:2.6.3/servicelifecycle/servicegroup' target='_blank' rel='external'>ServiceGroup</a></code> with appropriate termination behaviors for each service and initiates its execution.</p></li></ol><h2 id='Conclusion'><a href='#Conclusion'>Conclusion</a></h2><p>In summary, Swift Service Lifecycle simplifies application startup and shutdown, ensuring efficient resource management. It encapsulates critical startup and shutdown workflows in a reusable, framework-agnostic manner, enhancing application robustness.</p><p>The library’s seamless integration with Structured Concurrency simplifies the management of concurrent tasks, including first-class support for async sequences and facilitating efficient resource utilization.</p><p>The detailed documentation, intended for both <a href='https://swiftpackageindex.com/swift-server/swift-service-lifecycle/main/documentation/servicelifecycle/how-to-adopt-servicelifecycle-in-applications' target='_blank' rel='external nofollow noopener ugc'>application</a> and <a href='https://swiftpackageindex.com/swift-server/swift-service-lifecycle/main/documentation/servicelifecycle/how-to-adopt-servicelifecycle-in-libraries' target='_blank' rel='external nofollow noopener ugc'>library</a> developers, includes examples demonstrating how to use the features, which helps developers grasp the core concepts of the Swift Service Lifecycle library.</p></section><div style='display: none;' id='swiftinit-tooltips'><a href='/hist/swift-service-lifecycle:2.6.3/servicelifecycle/service'><pre><code><span class='xk'>protocol</span> <span class='xv'>Service</span> : <span class='xt'>Sendable</span></code></pre><p>This is the basic protocol that a service has to implement.</p></a><a href='/hist/swift-service-lifecycle:2.6.3/servicelifecycle/service.run'><pre><code><span class='xk'>func</span> <span class='xv'>run</span>(<wbr>) <span class='xk'>async</span> <span class='xk'>throws</span></code></pre><p>This method is called when the <code>ServiceGroup</code> is starting all the services.</p></a><a href='/hist/swift-service-lifecycle:2.6.3/servicelifecycle/servicegroup'><pre><code><span class='xk'>actor</span> <span class='xv'>ServiceGroup</span></code></pre><p>A <code>ServiceGroup</code> is responsible for running a number of services, setting up signal handling and signalling graceful shutdown to the services.</p></a><a href='/hist/swift-service-lifecycle:2.6.3/servicelifecycle/servicegroupconfiguration/serviceconfiguration.successterminationbehavior'><pre><code><span class='xk'>var</span> <span class='xv'>successTerminationBehavior</span>: <span class='xt'>TerminationBehavior</span></code></pre><p>The behavior when the service returns from its <code>run</code> method.</p></a><a href='/hist/swift-service-lifecycle:2.6.3/servicelifecycle.gracefulshutdown'><pre><code><span class='xk'>func</span> <span class='xv'>gracefulShutdown</span>(<wbr>) <span class='xk'>async</span> <span class='xk'>throws</span></code></pre><p>Waits until graceful shutdown is triggered.</p></a><a href='/hist/swift-service-lifecycle:2.6.3/servicelifecycle.withgracefulshutdownhandler(isolation:operation:ongracefulshutdown:)'><pre><code><span class='xk'>func</span> <span class='xv'>withGracefulShutdownHandler</span>&lt;<span class='xu'>T</span>&gt;(<span class='xi'></span><span class='xv'>isolation</span>: <span class='xk'>isolated</span> (<span class='xk'>any</span> <span class='xt'>Actor</span>)? = #<span class='xv'>isolation</span>, <span class='xi'></span><span class='xv'>operation</span>: () <span class='xk'>async</span> <span class='xk'>throws</span> -&gt; <span class='xt'>T</span>, <span class='xi'></span><span class='xv'>onGracefulShutdown</span> <span class='xb'>handler</span>: <span class='xa'>@escaping</span> () -&gt; <span class='xt'>Void</span><wbr>) <span class='xk'>async</span> <span class='xk'>rethrows</span> -&gt; <span class='xt'>T</span></code></pre><p>Execute an operation with a graceful shutdown handler that’s immediately invoked if the current task is shutting down gracefully.</p></a></div>
                    
                </section>
    
                <footer>
                    <br>
                    <time datetime=""></time>
    
                    
                    <div class="author-list">
                        <a href="https://swiftonserver.com/authors/tibor-bodecs/">
                        <img class="small rounded" src="https://swiftonserver.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor Bödecs">
                        <span class="name">Tibor Bödecs</span>
                        </a>
                    </div>
                    <div class="tag-list">
                        <a href="https://swiftonserver.com/tags/package-highlight/"><small>Package Highlight</small></a>
                    </div>
                </footer>
                            
                <section class="group">
                    <h4>Related posts</h4>                
                    <div class="grid grid-221">
                        <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://swiftonserver.com/authors/tibor-bodecs/">
                                <img class="small rounded" src="https://swiftonserver.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor Bödecs">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2024-10-22">2024-10-22</time>
                                    &middot; <span class="reading-time">10 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://swiftonserver.com/beginners-guide-to-protocol-buffers-and-grpc-with-swift/" target="">Beginner&#39;s Guide to Protocol Buffers and gRPC with Swift</a></h2>
                            <p>Learn Protocol Buffers and gRPC with Swift in this easy, step-by-step beginner&#39;s guide.</p>
                        
                            <div class="spacer"></div>
                        
                            <div class="tag-list">
                                <a href="https://swiftonserver.com/tags/networking/"><small>Networking</small></a>
        <a href="https://swiftonserver.com/tags/package-highlight/"><small>Package Highlight</small></a>
        <a href="https://swiftonserver.com/tags/server/"><small>Server</small></a>
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://swiftonserver.com/authors/tibor-bodecs/">
                                <img class="small rounded" src="https://swiftonserver.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor Bödecs">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2024-05-22">2024-05-22</time>
                                    &middot; <span class="reading-time">7 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://swiftonserver.com/introduction-to-swift-service-lifecycle/" target="">Introduction to Swift Service Lifecycle</a></h2>
                            <p>This article offers practical examples to introduce the Swift Service Lifecycle library.</p>
                        
                            <div class="spacer"></div>
                        
                            <div class="tag-list">
                                <a href="https://swiftonserver.com/tags/package-highlight/"><small>Package Highlight</small></a>
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://swiftonserver.com/authors/joannis-orlandos/">
                                <img class="small rounded" src="https://swiftonserver.com/assets/authors/joannis-orlandos/joannis-orlandos.jpeg" alt="Joannis Orlandos">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2024-05-14">2024-05-14</time>
                                    &middot; <span class="reading-time">3 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://swiftonserver.com/templating-with-swift-mustache/" target="">Templating with Swift-Mustache</a></h2>
                            <p>Learn how to template emails and web pages with Swift-Mustache.</p>
                        
                            <div class="spacer"></div>
                        
                            <div class="tag-list">
                                <a href="https://swiftonserver.com/tags/package-highlight/"><small>Package Highlight</small></a>
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://swiftonserver.com/authors/tibor-bodecs/">
                                <img class="small rounded" src="https://swiftonserver.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor Bödecs">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2024-04-03">2024-04-03</time>
                                    &middot; <span class="reading-time">13 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://swiftonserver.com/async-http-client-by-example/" target="">AsyncHTTPClient by example</a></h2>
                            <p>This article offers practical examples to introduce the Swift AsyncHTTPClient library.</p>
                        
                            <div class="spacer"></div>
                        
                            <div class="tag-list">
                                <a href="https://swiftonserver.com/tags/networking/"><small>Networking</small></a>
        <a href="https://swiftonserver.com/tags/package-highlight/"><small>Package Highlight</small></a>
                            </div>
                        </div>
                    </div>
                </section>
    
            </article>
        </div>
        
        <div>
            <div class="support">
                <a href="https://www.serversideswift.info/" target="_blank">
                    <img src="https://swiftonserver.com/images/logos/serversideswift.png" alt="ServerSide.swift logo">
                </a>
                <h4>
                    <a href="https://www.serversideswift.info/" target="_blank">ServerSide.swift</a>
                </h4>
                <p>
                    <b>Server-Side Swift Conference</b>
                    <br>
                    2nd-3rd October 2025. London, UK
                </p>
                <a class="cta" href="https://www.serversideswift.info/tickets/" target="_blank">Get Tickets</a>
            </div>
            
            <aside id="toc">
                <h4>On this page</h4>
                <ul>
                    <li class="first-level">
                        <a href="#A%20basic%20service%20example">A basic service example</a>
                        <ul>
                        </ul>
                    </li>
        <li class="first-level">
                        <a href="#Graceful%20shutdown%20and%20cancellation%20signals">Graceful shutdown and cancellation signals</a>
                        <ul>
                        </ul>
                    </li>
        <li class="first-level">
                        <a href="#Service%20composition">Service composition</a>
                        <ul>
                        </ul>
                    </li>
        <li class="first-level">
                        <a href="#Conclusion">Conclusion</a>
                        <ul>
                        </ul>
                    </li>
                </ul>
            </aside>
    
        </div>
    </div>
    
    </main>

    <footer id="site-footer">
        <div class="grid grid-421">
    
            <figure>
                <picture>
                    <source
                        srcset="https://swiftonserver.com/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="https://swiftonserver.com/images/logos/logo.png"
                        alt="Logo of Swift on server"
                        title="Swift on server"
                    >
                </picture>
            </figure>
            
            <div>
                <span style="display: block; height: 32px;">&nbsp;</span>
                <h4>Swift on server</h4>
                <p><small><a href="/" target="_blank">swiftonserver.com</a></small></p>
                <ul>
                    <li><a href="https://github.com/swift-on-server/" target="_blank">GitHub</a></li>
                    <li><a href="https://mastodon.social/@swiftonserver/" target="_blank">Mastodon</a></li>
                    <li><a href="/rss.xml" target="_blank">RSS</a></li>
                    <li><a href="/sitemap.xml" target="_blank">Sitemap</a></li>
                </ul>
            </div>
            
            <div>
                <a href="/authors/joannis-orlandos/">
                <img class="small rounded" src="https://swiftonserver.com/assets/authors/joannis-orlandos/joannis-orlandos.jpeg" alt="Joannis Orlandos">
                </a>
                <h4><a href="/authors/joannis-orlandos/">Joannis Orlandos</a></h4>
                <p><small><a href="https://unbeatable.software/" target="_blank">Unbeatable Software B.V.</a></small></p>
                <ul>
                    <li><a href="mailto:hello@unbeatable.software" target="_blank">Email</a></li>
                    <li><a href="https://github.com/Joannis" target="_blank">GitHub</a></li>
                    <li><a href="https://x.com/JoannisOrlandos" target="_blank">X (Twitter)</a></li>
                    <li><a href="https://mastodon.social/@joannis@fosstodon.org" target="_blank">Mastodon</a></li>
                </ul>
            </div>
            
            <div>
                <a href="/authors/tibor-bodecs/">
                <img class="small rounded" src="https://swiftonserver.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor Bödecs">
                </a>
                <h4><a href="/authors/tibor-bodecs/">Tibor Bödecs</a></h4>
                <p><small><a href="https://binarybirds.com/" target="_blank">Binary Birds Kft.</a></small></p>
                <ul>
                    <li><a href="mailto:mail.tib@gmail.com" target="_blank">Email</a></li>
                    <li><a href="https://github.com/tib/" target="_blank">GitHub</a></li>
                    <li><a href="https://x.com/tiborbodecs" target="_blank">X (Twitter)</a></li>
                    <li><a href="https://mastodon.social/@tiborbodecs" target="_blank">Mastodon</a></li>
                </ul>
            </div>
            
        </div>
        
        <section class="grid grid-221">
            <small>Swift on server &copy; 2022 - 2025</small>
            <small>This site was generated using <a href="https://swift.org/" target="_blank">Swift</a> & <a href="https://github.com/binarybirds/toucan" target="_blank">Toucan</a>.</small>
        </section>
    </footer>

    </div>

    

    <script type="text/javascript" src="/js/tooltips.js" async=""></script>
</body>
</html>
