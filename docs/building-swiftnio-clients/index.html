<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://swiftonserver.com/building-swiftnio-clients/">
    <link rel="prev" href="https://swiftonserver.com/logging-for-server-side-swift-apps/">
    <link rel="next" href="https://swiftonserver.com/whats-new-in-hummingbird-2/">

    <title>Building an HTTP client using SwiftNIO - Swift on server</title>
    <meta name="description" content="Learn how to build a simple HTTP client using SwiftNIO and structured concurrency.">

    <meta property="og:url" content="https://swiftonserver.com/building-swiftnio-clients/">
    <meta property="og:title" content="Building an HTTP client using SwiftNIO - Swift on server">
    <meta property="og:description" content="Learn how to build a simple HTTP client using SwiftNIO and structured concurrency.">
    <meta property="og:image" content="https://swiftonserver.com/assets/building-swiftnio-clients/cover.jpg" />

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Building an HTTP client using SwiftNIO - Swift on server">
    <meta name="twitter:description" content="Learn how to build a simple HTTP client using SwiftNIO and structured concurrency.">
    <meta name="twitter:image" content="https://swiftonserver.com/assets/building-swiftnio-clients/cover.jpg">

    <link rel="stylesheet" href="https://swiftonserver.com/css/modern-normalize.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/modern-base.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/variables.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/base.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/grid.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/navigation.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/footer.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/syntax.css">
    <link rel="stylesheet" href="https://swiftonserver.com/css/style.css">

    

    <link rel="shortcut icon" href="https://swiftonserver.com/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://swiftonserver.com/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="https://swiftonserver.com/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="https://swiftonserver.com/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://swiftonserver.com/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://swiftonserver.com/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://swiftonserver.com/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://swiftonserver.com/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://swiftonserver.com/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://swiftonserver.com/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://swiftonserver.com/images/icons/apple-touch-icon-180x180.png">

    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
        media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
        media="(prefers-color-scheme: dark)"
    >

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
          const container = document.querySelector("div#swiftinit-tooltips");
          if (container !== null) {
              container.querySelectorAll('pre code').forEach((el) => {
                  el.classList.add('nohighlight');
              });
          }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
          document.querySelectorAll('section pre code:not(.language-swift').forEach((el) => {
              hljs.highlightElement(el);
          });
        });
    </script>

    <script defer data-domain="swiftonserver.com" src="https://plausible.io/js/script.js"></script>

</head>

<body>
    <div id="site-container">

    <header id="navigation">
        <a href="/">
            <figure>
                <picture>
                    <source
                        srcset="https://swiftonserver.com/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        src="https://swiftonserver.com/images/logos/logo.png"
                        alt="Logo of Swift on server"
                        title="Swift on server"
                    >
                </picture>
            </figure>
        </a>
        <nav>
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="https://swiftonserver.com/posts/page/1/">Posts</a>
            <a href="https://swiftonserver.com/tags/">Tags</a>
            <a href="https://swiftonserver.com/authors/">Authors</a>
            <a href="https://swiftonserver.com/newsletter/">Newsletter</a>
            </div>
        </nav>
    </header>

    <main id="page-container">
    
    <div class="article-with-toc">
        <div>
            <article class="post">
                <div class="meta">
                    <time datetime="2024-02-20">2024-02-20</time>
                     &middot; <span class="reading-time">11 min read</span>
                    
                </div>
                <section>
                
                <section class='introduction'><h1>Building a SwiftNIO HTTP client</h1></section><section class='details literature'><p>HTTP clients are a common first networking application to build. HTTP is a well known and simple to understand protocol, making it an excellent start.</p><p>In the previous tutorial, <a href='../using-swiftnio-channels'>SwiftNIO Channels</a>, you learned how to use SwiftNIO to build a simple TCP echo server. In this tutorial, you’ll build a simple HTTP client using SwiftNIO.</p><p>We’ll use the <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niohttp1' target='_blank' rel='external'>NIOHTTP1</a></code> package for parsing and serializing HTTP messages. In addition, SwiftNIO’s structured concurrency is used to manage the lifecycle of our client.</p><p>By the end of this tutorial, you’ll know how to configure a SwiftNIO Channel’s pipeline, and are able to send HTTP requests to a server.</p><p><a href='https://github.com/swift-on-server/building-swiftnio-clients-sample' target='_blank' rel='external'>Download the Samples</a> to get started. It has a dev container for a quick start.</p><aside class='note'><h3>Note</h3><p>This tutorial will emit some <code><a href='https://swiftinit.org/docs/swift/swift/sendable' target='_blank' rel='external'>Sendable</a></code> warnings. These are expected, and should be resolved in a production ready client implementation. However, for the purposes of this tutorial, ignore them.</p></aside><h2 id='Creating%20a%20Client%20Channel'><a href='#Creating%20a%20Client%20Channel'>Creating a Client Channel</a></h2><p>In SwiftNIO, Channels are created through a bootstrap. For TCP clients, you’d generally use a <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/nioposix/clientbootstrap' target='_blank' rel='external'>ClientBootstrap</a></code>. There are alternative clients as well, such as Apple’s Transport Services for Apple platforms. In addition, the <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niohttp1' target='_blank' rel='external'>NIOHTTP1</a></code> module is used to simplify the process of creating a client channel.</p><p>Add these dependencies to your executable target in your <code>Package.swift</code> file:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span>.<span class='xv'>executableTarget</span>(<span class='newline'>
</span>    <span class='xv'>name</span>: <span class='xs'>"swift-nio-part-3"</span>,<span class='newline'>
</span>    <span class='xv'>dependencies</span>: [<span class='newline'>
</span>        .<span class='xv'>product</span>(<span class='xv'>name</span>: <span class='xs'>"NIO"</span>, <span class='xv'>package</span>: <span class='xs'>"swift-nio"</span>),<span class='newline'>
</span>        .<span class='xv'>product</span>(<span class='xv'>name</span>: <span class='xs'>"NIOHTTP1"</span>, <span class='xv'>package</span>: <span class='xs'>"swift-nio"</span>),<span class='newline'>
</span>    ]<span class='newline'>
</span>),</code></pre><p>Now, let’s create a <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/nioposix/clientbootstrap' target='_blank' rel='external'>ClientBootstrap</a></code> and configure it to use the <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niohttp1' target='_blank' rel='external'>NIOHTTP1</a></code> module’s handlers. First, import the necessary modules:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>import</span> <span class='xv'>NIOCore</span><span class='newline'>
</span><span class='xk'>import</span> <span class='xv'>NIOHTTP1</span><span class='newline'>
</span><span class='xk'>import</span> <span class='xv'>HTTPTypes</span><span class='newline'>
</span><span class='xk'>import</span> <span class='xv'>NIOHTTPTypes</span><span class='newline'>
</span><span class='xk'>import</span> <span class='xv'>NIOHTTPTypesHTTP1</span><span class='newline'>
</span><span class='xk'>import</span> <span class='xv'>NIOPosix</span></code></pre><a rel='ugc' href='https://github.com/swift-on-server/articles/blob/main/Snippets/building-swiftnio-clients-01.swift' target='_blank' class='source github'><span class='file'>building-swiftnio-clients-01.swift</span></a><p>Then, create a <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/nioposix/clientbootstrap' target='_blank' rel='external'>ClientBootstrap</a></code>:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xc'>// 1</span><span class='newline'>
</span><span class='xk'>let</span> <span class='xv'>httpClientBootstrap</span> = <a class='xt' href='https://swiftinit.org/hist/swift-nio:2.79.0/nioposix/clientbootstrap' target='_blank' rel='external'>ClientBootstrap</a>(<span class='newline'>
</span>    <span class='xv'>group</span>: <a class='xt' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/niosingletons' target='_blank' rel='external'>NIOSingletons</a>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/niosingletons.posixeventloopgroup' target='_blank' rel='external'>posixEventLoopGroup</a><span class='newline'>
</span>)<span class='newline'>
</span><span class='xc'>// 2</span><span class='newline'>
</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/nioposix/clientbootstrap.channeloption(_:value:)' target='_blank' rel='external'>channelOption</a>(<a class='xt' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channeloptions' target='_blank' rel='external'>ChannelOptions</a>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channeloptions.socketoption' target='_blank' rel='external'>socketOption</a>(.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/niobsdsocket/option.so_reuseaddr' target='_blank' rel='external'>so_reuseaddr</a>), <span class='xv'>value</span>: <span class='xn'>1</span>)<span class='newline'>
</span><span class='xc'>// 3</span><span class='newline'>
</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/nioposix/clientbootstrap.channelinitializer(_:)' target='_blank' rel='external'>channelInitializer</a> { <span class='xv'>channel</span> <span class='xk'>in</span><span class='newline'>
</span>    <span class='xc'>// 4</span><span class='newline'>
</span>    <span class='xv'>channel</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channeloutboundinvoker.eventloop' target='_blank' rel='external'>eventLoop</a>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/eventloop.makecompletedfuture(withresultof:)' target='_blank' rel='external'>makeCompletedFuture</a> {<span class='newline'>
</span>        <span class='xk'>try</span> <span class='xv'>channel</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channel.pipeline' target='_blank' rel='external'>pipeline</a>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channelpipeline.syncoperations' target='_blank' rel='external'>syncOperations</a>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channelpipeline/synchronousoperations.addhttpclienthandlers(position:leftoverbytesstrategy:withclientupgrade:)' target='_blank' rel='external'>addHTTPClientHandlers</a>()<span class='newline'>
</span>        <span class='xk'>try</span> <span class='xv'>channel</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channel.pipeline' target='_blank' rel='external'>pipeline</a>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channelpipeline.syncoperations' target='_blank' rel='external'>syncOperations</a>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channelpipeline/synchronousoperations.addhandler(_:name:position:)' target='_blank' rel='external'>addHandler</a>(<a class='xt' href='https://swiftinit.org/hist/swift-nio-extras:1.24.1/niohttptypeshttp1/http1tohttpclientcodec' target='_blank' rel='external'>HTTP1ToHTTPClientCodec</a>())<span class='newline'>
</span>    }<span class='newline'>
</span>}</code></pre><a rel='ugc' href='https://github.com/swift-on-server/articles/blob/main/Snippets/building-swiftnio-clients-01.swift#L30' target='_blank' class='source github'><span class='file'>building-swiftnio-clients-01.swift</span>:<span class='line'>30</span></a><p>This code prepares a template for creating a client channel. Let’s break it down:</p><ol><li><p>Create a <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/nioposix/clientbootstrap' target='_blank' rel='external'>ClientBootstrap</a></code> using the <code>NIOSingletons.posixEventLoopGroup</code> as the event loop group. This is a shared event loop group that can be reused across multiple components of our application.</p></li><li><p>NIO Channels can have options set on them. Here, the <code>SO_REUSEADDR</code> option is set to <code>1</code> to allow the reuse of local addresses.</p></li><li><p>Then, provide an initializer that is used to configure the pipeline of newly created channels.</p></li><li><p>Finally, the <code>channelInitializer</code> adds the necessary HTTP client handlers to the channel’s pipeline. This uses a helper function provided by NIOHTTP1.</p></li></ol><h2 id='Creating%20Types'><a href='#Creating%20Types'>Creating Types</a></h2><p>Before creating the HTTP client, it’s necessary to add a few types that are needed for processing HTTP requests and responses.</p><p>When a <code>connect</code> fails, NIO already throws an error. There is no need to catch or represent those. However, the HTTP Client might encounter errors when processing the response. Create an enum to represent these errors:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>enum</span> <span class='xt'>HTTPClientError</span>: <a class='xt' href='https://swiftinit.org/docs/swift/swift/error' target='_blank' rel='external'>Error</a> {<span class='newline'>
</span>    <span class='xk'>case</span> <span class='xv'>malformedResponse</span>, <span class='xv'>unexpectedEndOfStream</span><span class='newline'>
</span>}</code></pre><a rel='ugc' href='https://github.com/swift-on-server/articles/blob/main/Snippets/building-swiftnio-clients-01.swift#L18' target='_blank' class='source github'><span class='file'>building-swiftnio-clients-01.swift</span>:<span class='line'>18</span></a><p>Finally, add an enum to represent the state of processing the response:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>enum</span> <span class='xt'>HTTPPartialResponse</span> {<span class='newline'>
</span>    <span class='xk'>case</span> <span class='xv'>none</span><span class='newline'>
</span>    <span class='xk'>case</span> <span class='xv'>receiving</span>(<a class='xt' href='https://swiftinit.org/docs/swift-http-types/httptypes/httpresponse' target='_blank' rel='external'>HTTPResponse</a>, <a class='xt' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/bytebuffer' target='_blank' rel='external'>ByteBuffer</a>)<span class='newline'>
</span>}</code></pre><a rel='ugc' href='https://github.com/swift-on-server/articles/blob/main/Snippets/building-swiftnio-clients-01.swift#L11' target='_blank' class='source github'><span class='file'>building-swiftnio-clients-01.swift</span>:<span class='line'>11</span></a><p>The enum if pretty simple, and is not representative of a <em>mature</em> HTTP client implementation such as <a href='https://github.com/swift-server/async-http-client' target='_blank' rel='external'>AsyncHTTPClient</a>. However, it’s enough to get started with building a (TCP) client.</p><h2 id='Implementing%20the%20HTTP%20Client'><a href='#Implementing%20the%20HTTP%20Client'>Implementing the HTTP Client</a></h2><p>Now that the necessary types have been created, create the <code>HTTPClient</code> type with a simple function that sends a request and returns the response.</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>struct</span> <span class='xt'>HTTPClient</span> {<span class='newline'>
</span>    <span class='xk'>let</span> <span class='xv'>host</span>: <a class='xt' href='https://swiftinit.org/docs/swift/swift/string' target='_blank' rel='external'>String</a><span class='newline'>
</span>    <span class='xk'>let</span> <span class='xv'>httpClientBootstrap</span>: <a class='xt' href='https://swiftinit.org/hist/swift-nio:2.79.0/nioposix/clientbootstrap' target='_blank' rel='external'>ClientBootstrap</a><span class='newline'>

</span>    <span class='xk'>init</span>(<span class='xv'>host</span>: <a class='xt' href='https://swiftinit.org/docs/swift/swift/string' target='_blank' rel='external'>String</a>) {</code></pre><a rel='ugc' href='https://github.com/swift-on-server/articles/blob/main/Snippets/building-swiftnio-clients-01.swift#L24' target='_blank' class='source github'><span class='file'>building-swiftnio-clients-01.swift</span>:<span class='line'>24</span></a><p>Let’s break it down:</p><ol><li><p>Use the <code>httpClientBootstrap</code> to create a new client channel. This returns an <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/eventloopfuture' target='_blank' rel='external'>EventLoopFuture</a></code> containing a regular NIO <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channel' target='_blank' rel='external'>Channel</a></code>. By using <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/eventloopfuture.flatmapthrowing(_:)' target='_blank' rel='external'>flatMapThrowing(_:)</a></code> to transform the result of this future, it’s possible to convert the <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/eventloopfuture' target='_blank' rel='external'>EventLoopFuture</a></code> into a <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/nioasyncchannel' target='_blank' rel='external'>NIOAsyncChannel</a></code>.</p></li><li><p>In order to use structured concurrency, it’s necessary to wrap the <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channel' target='_blank' rel='external'>Channel</a></code> in an <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/nioasyncchannel' target='_blank' rel='external'>NIOAsyncChannel</a></code>. The inbound and outbound types must be <code><a href='https://swiftinit.org/docs/swift/swift/sendable' target='_blank' rel='external'>Sendable</a></code>, and need to be configured to match the pipeline’s input and output. This is based on the handlers added in the bootstrap’s <code>channelInitializer</code>.</p></li><li><p>The <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/nioasyncchannel' target='_blank' rel='external'>NIOAsyncChannel</a></code> is configured to receive <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niohttp1/httpclientresponsepart' target='_blank' rel='external'>HTTPClientResponsePart</a></code> objects. This is the type that the HTTP client will receive from the server.</p></li><li><p>The <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/nioasyncchannel' target='_blank' rel='external'>NIOAsyncChannel</a></code> is configured to send <code>SendableHTTPClientRequestPart</code> objects. This is the type that the HTTP client will send to the server.</p></li><li><p>The <code>get()</code> method is called to <em>await</em> for the result of the <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/eventloopfuture' target='_blank' rel='external'>EventLoopFuture</a></code>.</p></li></ol><h3 id='Sending%20a%20Request'><a href='#Sending%20a%20Request'>Sending a Request</a></h3><p>In place of the TODO comment, add the code to send a request and process the response. First, create a <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niohttp1/httprequesthead' target='_blank' rel='external'>HTTPRequestHead</a></code>. Note that this function does not currently support sending a body with the request. Do so by adding the following code:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xc'>// 1</span><span class='newline'>
</span><span class='xk'>return</span> <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>clientChannel</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/nioasyncchannel.executethenclose(_:)?hash=2G196' target='_blank' rel='external'>executeThenClose</a> { <span class='xv'>inbound</span>, <span class='xv'>outbound</span> <span class='xk'>in</span><span class='newline'>
</span>    <span class='xc'>// 2</span><span class='newline'>
</span>    <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>outbound</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/nioasyncchanneloutboundwriter.write(_:)' target='_blank' rel='external'>write</a>(<span class='newline'>
</span>        .<a class='xv' href='https://swiftinit.org/hist/swift-nio-extras:1.24.1/niohttptypes/httprequestpart.head(_:)' target='_blank' rel='external'>head</a>(<span class='newline'>
</span>            <a class='xt' href='https://swiftinit.org/docs/swift-http-types/httptypes/httprequest' target='_blank' rel='external'>HTTPRequest</a>(<span class='newline'>
</span>                <span class='xv'>method</span>: <span class='xv'>method</span>,<span class='newline'>
</span>                <span class='xv'>scheme</span>: <span class='xs'>"http"</span>,<span class='newline'>
</span>                <span class='xv'>authority</span>: <span class='xv'>host</span>,<span class='newline'>
</span>                <span class='xv'>path</span>: <span class='xv'>path</span>,<span class='newline'>
</span>                <span class='xv'>headerFields</span>: <span class='xv'>headers</span><span class='newline'>
</span>            )<span class='newline'>
</span>        )<span class='newline'>
</span>    )<span class='newline'>
</span>    <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>outbound</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/nioasyncchanneloutboundwriter.write(_:)' target='_blank' rel='external'>write</a>(.<a class='xv' href='https://swiftinit.org/hist/swift-nio-extras:1.24.1/niohttptypes/httprequestpart.end(_:)' target='_blank' rel='external'>end</a>(<span class='xk'>nil</span>))</code></pre><a rel='ugc' href='https://github.com/swift-on-server/articles/blob/main/Snippets/building-swiftnio-clients-01.swift#L75' target='_blank' class='source github'><span class='file'>building-swiftnio-clients-01.swift</span>:<span class='line'>75</span></a><p>This is a structured concurrency block that sends the request:</p><ol><li><p>The <code>executeThenClose</code> method is used to obtain a read and write half of the channel. This function returns the result of it’s trailing closure.</p></li><li><p>The writer called <code>outbound</code> is used to send the request’s part - the head and ‘end’. This is also where the request’s body would be sent.</p></li></ol><p>Below that, receive and process the response parts as such:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>var</span> <span class='xv'>partialResponse</span> = <span class='xt'>HTTPPartialResponse</span>.<span class='xv'>none</span><span class='newline'>

</span><span class='xc'>// 1</span><span class='newline'>
</span><span class='xk'>for</span> <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>part</span> <span class='xk'>in</span> <span class='xv'>inbound</span> {<span class='newline'>
</span>    <span class='xc'>// 2</span><span class='newline'>
</span>    <span class='xk'>switch</span> <span class='xv'>part</span> {<span class='newline'>
</span>    <span class='xk'>case</span> .<a class='xv' href='https://swiftinit.org/hist/swift-nio-extras:1.24.1/niohttptypes/httpresponsepart.head(_:)' target='_blank' rel='external'>head</a>(<span class='xk'>let</span> <span class='xv'>head</span>):<span class='newline'>
</span>        <span class='xk'>guard</span> <span class='xk'>case</span> .<span class='xv'>none</span> = <span class='xv'>partialResponse</span> <span class='xk'>else</span> {<span class='newline'>
</span>            <span class='xk'>throw</span> <span class='xt'>HTTPClientError</span>.<span class='xv'>malformedResponse</span><span class='newline'>
</span>        }<span class='newline'>

</span>        <span class='xk'>let</span> <span class='xv'>buffer</span> = <span class='xv'>clientChannel</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/nioasyncchannel.channel' target='_blank' rel='external'>channel</a>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/channel.allocator' target='_blank' rel='external'>allocator</a>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/bytebufferallocator.buffer(capacity:)' target='_blank' rel='external'>buffer</a>(<span class='newline'>
</span>            <span class='xv'>capacity</span>: <span class='xn'>0</span><span class='newline'>
</span>        )<span class='newline'>
</span>        <span class='xv'>partialResponse</span> = .<span class='xv'>receiving</span>(<span class='xv'>head</span>, <span class='xv'>buffer</span>)<span class='newline'>
</span>    <span class='xk'>case</span> .<a class='xv' href='https://swiftinit.org/hist/swift-nio-extras:1.24.1/niohttptypes/httpresponsepart.body(_:)' target='_blank' rel='external'>body</a>(<span class='xk'>let</span> <span class='xv'>buffer</span>):<span class='newline'>
</span>        <span class='xk'>guard</span><span class='newline'>
</span>            <span class='xk'>case</span> .<span class='xv'>receiving</span>(<span class='xk'>let</span> <span class='xv'>head</span>, <span class='xk'>var</span> <span class='xv'>existingBuffer</span>) =<span class='newline'>
</span>                <span class='xv'>partialResponse</span><span class='newline'>
</span>        <span class='xk'>else</span> {<span class='newline'>
</span>            <span class='xk'>throw</span> <span class='xt'>HTTPClientError</span>.<span class='xv'>malformedResponse</span><span class='newline'>
</span>        }<span class='newline'>

</span>        <span class='xv'>existingBuffer</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/bytebuffer.writeimmutablebuffer(_:)' target='_blank' rel='external'>writeImmutableBuffer</a>(<span class='xv'>buffer</span>)<span class='newline'>
</span>        <span class='xv'>partialResponse</span> = .<span class='xv'>receiving</span>(<span class='xv'>head</span>, <span class='xv'>existingBuffer</span>)<span class='newline'>
</span>    <span class='xk'>case</span> .<a class='xv' href='https://swiftinit.org/hist/swift-nio-extras:1.24.1/niohttptypes/httpresponsepart.end(_:)' target='_blank' rel='external'>end</a>:<span class='newline'>
</span>        <span class='xk'>guard</span><span class='newline'>
</span>            <span class='xk'>case</span> .<span class='xv'>receiving</span>(<span class='xk'>let</span> <span class='xv'>head</span>, <span class='xk'>let</span> <span class='xv'>buffer</span>) = <span class='xv'>partialResponse</span><span class='newline'>
</span>        <span class='xk'>else</span> {<span class='newline'>
</span>            <span class='xk'>throw</span> <span class='xt'>HTTPClientError</span>.<span class='xv'>malformedResponse</span><span class='newline'>
</span>        }<span class='newline'>

</span>        <span class='xk'>return</span> (<span class='xv'>head</span>, <span class='xv'>buffer</span>)<span class='newline'>
</span>    }<span class='newline'>
</span>}<span class='newline'>

</span><span class='xc'>// 3</span><span class='newline'>
</span><span class='xk'>throw</span> <span class='xt'>HTTPClientError</span>.<span class='xv'>unexpectedEndOfStream</span></code></pre><a rel='ugc' href='https://github.com/swift-on-server/articles/blob/main/Snippets/building-swiftnio-clients-01.swift#L93' target='_blank' class='source github'><span class='file'>building-swiftnio-clients-01.swift</span>:<span class='line'>93</span></a><p>This sets up a state variable to keep track of the response parts received. It then processes the response parts as they come in:</p><ol><li><p>A <code>for</code> loop is used to iterate over the response parts. This is a structured concurrency block that will continue to run until the channel is closed by the remote, an error is thrown, or a <code>return</code> statement ends the function.</p></li><li><p>The <code>part</code> is matched against the <code><a href='https://swiftinit.org/hist/swift-nio:2.79.0/niohttp1/httpclientresponsepart' target='_blank' rel='external'>HTTPClientResponsePart</a></code> enum. If the part is a head, it’s stored in the <code>partialResponse</code> variable. If the part is a body, it’s appended to the buffer in the <code>partialResponse</code> variable. If the part is an end, the <code>partialResponse</code> is returned.</p></li><li><p>If the loop ends without a return, an error is thrown, since the code was unable to receive a complete response.</p></li></ol><h2 id='Using%20the%20Client'><a href='#Using%20the%20Client'>Using the Client</a></h2><p>Now that the HTTP client is complete, it’s time to use it. Add the following code to the <code>main.swift</code> file:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>let</span> <span class='xv'>client</span> = <span class='xt'>HTTPClient</span>(<span class='xv'>host</span>: <span class='xs'>"example.com"</span>)<span class='newline'>
</span><span class='xk'>let</span> (<span class='xv'>response</span>, <span class='xv'>body</span>) = <span class='xk'>try</span> <span class='xk'>await</span> <span class='xv'>client</span>.<span class='xv'>request</span>(<span class='xs'>"/"</span>)<span class='newline'>
</span><a class='xv' href='https://swiftinit.org/docs/swift/swift.print(_:separator:terminator:)' target='_blank' rel='external'>print</a>(<span class='xv'>response</span>)<span class='newline'>
</span><a class='xv' href='https://swiftinit.org/docs/swift/swift.print(_:separator:terminator:)' target='_blank' rel='external'>print</a>(<span class='xv'>body</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/bytebuffer.getstring(at:length:)' target='_blank' rel='external'>getString</a>(<span class='xv'>at</span>: <span class='xn'>0</span>, <span class='xv'>length</span>: <span class='xv'>body</span>.<a class='xv' href='https://swiftinit.org/hist/swift-nio:2.79.0/niocore/bytebuffer.readablebytes' target='_blank' rel='external'>readableBytes</a>)!)</code></pre><a rel='ugc' href='https://github.com/swift-on-server/articles/blob/main/Snippets/building-swiftnio-clients-01.swift#L137' target='_blank' class='source github'><span class='file'>building-swiftnio-clients-01.swift</span>:<span class='line'>137</span></a><p>This creates a client and sends a GET request to <code>example.com</code>. The response is then printed to the console.</p><p>If everything is set up correctly, you should see roughly the following output:</p><pre class='snippet'><code><span class='newline'></span>HTTPResponseHead { version: HTTP/1.1, status: 200 OK, headers: [("Accept-Ranges", "bytes"), ("Age", "464157"), ("Cache-Control", "max-age=604800"), ("Content-Type", "text/html; charset=UTF-8"), ("Date", "Wed, 07 Feb 2024 21:22:33 GMT"), ("Etag", "\"3147526947\""), ("Expires", "Wed, 14 Feb 2024 21:22:33 GMT"), ("Last-Modified", "Thu, 17 Oct 2019 07:18:26 GMT"), ("Server", "ECS (dce/26CD)"), ("Vary", "Accept-Encoding"), ("X-Cache", "HIT"), ("Content-Length", "1256")] }<span class='newline'>
</span>&lt;!doctype html&gt;<span class='newline'>
</span>&lt;html&gt;<span class='newline'>
</span>&lt;head&gt;<span class='newline'>
</span>    &lt;title&gt;Example Domain&lt;/title&gt;<span class='newline'>

</span>    &lt;meta charset="utf-8" /&gt;<span class='newline'>
</span>    &lt;meta http-equiv="Content-type" content="text/html; charset=utf-8" /&gt;<span class='newline'>
</span>    &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;<span class='newline'>
</span>    &lt;style type="text/css"&gt;<span class='newline'>
</span>    ....</code></pre><p>And that’s it! You’ve built a simple HTTP client using SwiftNIO. You can now use this client to send requests to any server that supports HTTP/1.1.</p></section><div style='display: none;' id='swiftinit-tooltips'><a href='/hist/swift-on-server.articles:main/articles/using-swiftnio-channels'><p>SwiftNIO revolves around networking. In SwiftNIO, reads and writes happen using a <code>Channel</code>.</p></a><a href='/hist/swift-nio:2.79.0/niohttp1'><pre><code><span class='xk'>import</span> <span class='xv'>NIOHTTP1</span></code></pre></a><a href='/docs/swift/swift/sendable'><pre><code><span class='xk'>protocol</span> <span class='xv'>Sendable</span></code></pre></a><a href='/hist/swift-nio:2.79.0/nioposix/clientbootstrap'><pre><code><span class='xk'>final</span> <span class='xk'>class</span> <span class='xv'>ClientBootstrap</span></code></pre><p>A <code>ClientBootstrap</code> is an easy way to bootstrap a <code>SocketChannel</code> when creating network clients.</p></a><a href='/hist/swift-nio:2.79.0/niocore/niosingletons'><pre><code><span class='xk'>enum</span> <span class='xv'>NIOSingletons</span></code></pre><p>SwiftNIO provided singleton resources for programs &amp; libraries that don’t need full control over all operating system resources. This type holds sizing (how many loops/threads) suggestions.</p></a><a href='/hist/swift-nio:2.79.0/niocore/niosingletons.posixeventloopgroup'><pre><code><span class='xk'>static</span> <span class='xk'>var</span> <span class='xv'>posixEventLoopGroup</span>: <span class='xt'>MultiThreadedEventLoopGroup</span> { <span class='xk'>get</span> }</code></pre><p>A globally shared, lazily initialized <code>MultiThreadedEventLoopGroup</code>  that uses <code>epoll</code>/<code>kqueue</code> as the selector mechanism.</p></a><a href='/hist/swift-nio:2.79.0/nioposix/clientbootstrap.channeloption(_:value:)'><pre><code><span class='xk'>func</span> <span class='xv'>channelOption</span>&lt;<span class='xu'>Option</span>&gt;(<span class='xi'></span>_ <span class='xb'>option</span>: <span class='xt'>Option</span>, <span class='xi'></span><span class='xv'>value</span>: <span class='xt'>Option</span>.<span class='xt'>Value</span><wbr>) -&gt; <span class='xk'>Self</span> <span class='xk'>where</span> <span class='xt'>Option</span> : <span class='xt'>ChannelOption</span></code></pre></a><a href='/hist/swift-nio:2.79.0/niocore/channeloptions'><pre><code><span class='xk'>struct</span> <span class='xv'>ChannelOptions</span></code></pre><p>Provides <code>ChannelOption</code>s to be used with a <code>Channel</code>, <code>Bootstrap</code> or <code>ServerBootstrap</code>.</p></a><a href='/hist/swift-nio:2.79.0/niocore/channeloptions.socketoption'><pre><code><span class='xk'>static</span> <span class='xk'>let</span> <span class='xv'>socketOption</span>: (<span class='xt'>NIOBSDSocket</span>.<span class='xt'>Option</span>) -&gt; <span class='xt'>ChannelOptions</span>.<span class='xt'>Types</span>.<span class='xt'>SocketOption</span></code></pre></a><a href='/hist/swift-nio:2.79.0/niocore/niobsdsocket/option.so_reuseaddr'><pre><code><span class='xk'>static</span> <span class='xk'>let</span> <span class='xv'>so_reuseaddr</span>: <span class='xt'>NIOBSDSocket</span>.<span class='xt'>Option</span></code></pre><p>Allows the socket to be bound to an address that is already in use.</p></a><a href='/hist/swift-nio:2.79.0/nioposix/clientbootstrap.channelinitializer(_:)'><pre><code><span class='xa'>@preconcurrency</span> <span class='xk'>func</span> <span class='xv'>channelInitializer</span>(<span class='xi'></span>_ <span class='xb'>handler</span>: <span class='xa'>@escaping</span> (<span class='xt'>Channel</span>) -&gt; <span class='xt'>EventLoopFuture</span>&lt;<span class='xt'>Void</span>&gt;<wbr>) -&gt; <span class='xk'>Self</span></code></pre></a><a href='/hist/swift-nio:2.79.0/niocore/channeloutboundinvoker.eventloop'><pre><code><span class='xk'>var</span> <span class='xv'>eventLoop</span>: <span class='xt'>EventLoop</span> { <span class='xk'>get</span> }</code></pre><p>The <code>EventLoop</code> which is used by this <code>ChannelOutboundInvoker</code> for execution.</p></a><a href='/hist/swift-nio:2.79.0/niocore/eventloop.makecompletedfuture(withresultof:)'><pre><code><span class='xa'>@preconcurrency</span> <span class='xk'>func</span> <span class='xv'>makeCompletedFuture</span>&lt;<span class='xu'>Success</span>&gt;(<span class='xi'></span><span class='xv'>withResultOf</span> <span class='xb'>body</span>: () <span class='xk'>throws</span> -&gt; <span class='xt'>Success</span><wbr>) -&gt; <span class='xt'>EventLoopFuture</span>&lt;<span class='xt'>Success</span>&gt; <span class='xk'>where</span> <span class='xt'>Success</span> : <span class='xt'>Sendable</span></code></pre><p>Creates and returns a new <code>EventLoopFuture</code> that is marked as succeeded or failed with the value returned by <code>body</code>.</p></a><a href='/hist/swift-nio:2.79.0/niocore/channel.pipeline'><pre><code><span class='xk'>var</span> <span class='xv'>pipeline</span>: <span class='xt'>ChannelPipeline</span> { <span class='xk'>get</span> }</code></pre><p>The <code>ChannelPipeline</code> which handles all I/O events and requests associated with this <code>Channel</code>.</p></a><a href='/hist/swift-nio:2.79.0/niocore/channelpipeline.syncoperations'><pre><code><span class='xk'>var</span> <span class='xv'>syncOperations</span>: <span class='xt'>SynchronousOperations</span> { <span class='xk'>get</span> }</code></pre><p>Returns a view of operations which can be performed synchronously on this pipeline. All operations <strong>must</strong> be called on the event loop.</p></a><a href='/hist/swift-nio:2.79.0/niocore/channelpipeline/synchronousoperations.addhttpclienthandlers(position:leftoverbytesstrategy:withclientupgrade:)'><pre><code><span class='xa'>@preconcurrency</span> <span class='xk'>func</span> <span class='xv'>addHTTPClientHandlers</span>(<span class='xi'></span><span class='xv'>position</span>: <span class='xt'>ChannelPipeline</span>.<span class='xt'>Position</span> = .<span class='xv'>last</span>, <span class='xi'></span><span class='xv'>leftOverBytesStrategy</span>: <span class='xt'>RemoveAfterUpgradeStrategy</span> = .<span class='xv'>dropBytes</span>, <span class='xi'></span><span class='xv'>withClientUpgrade</span> <span class='xb'>upgrade</span>: <span class='xt'>NIOHTTPClientUpgradeConfiguration</span>? = <span class='xk'>nil</span><wbr>) <span class='xk'>throws</span></code></pre><p>Configure a <code>ChannelPipeline</code> for use as a HTTP client with a client upgrader configuration.</p></a><a href='/hist/swift-nio:2.79.0/niocore/channelpipeline/synchronousoperations.addhandler(_:name:position:)'><pre><code><span class='xk'>func</span> <span class='xv'>addHandler</span>(<span class='xi'></span>_ <span class='xb'>handler</span>: <span class='xt'>ChannelHandler</span>, <span class='xi'></span><span class='xv'>name</span>: <span class='xt'>String</span>? = <span class='xk'>nil</span>, <span class='xi'></span><span class='xv'>position</span>: <span class='xt'>ChannelPipeline</span>.<span class='xt'>Position</span> = .<span class='xv'>last</span><wbr>) <span class='xk'>throws</span></code></pre><p>Add a handler to the pipeline.</p></a><a href='/hist/swift-nio-extras:1.24.1/niohttptypeshttp1/http1tohttpclientcodec'><pre><code><span class='xk'>final</span> <span class='xk'>class</span> <span class='xv'>HTTP1ToHTTPClientCodec</span></code></pre><p>A simple channel handler that translates HTTP/1 messages into shared HTTP types, and vice versa, for use on the client side.</p></a><a href='/docs/swift/swift/error'><pre><code><span class='xk'>protocol</span> <span class='xv'>Error</span> : <span class='xt'>Sendable</span></code></pre><p>A type representing an error value that can be thrown.</p></a><a href='/docs/swift-http-types/httptypes/httpresponse'><pre><code><span class='xk'>struct</span> <span class='xv'>HTTPResponse</span></code></pre><p>An HTTP response message consisting of the “:status” pseudo header field and header fields.</p></a><a href='/hist/swift-nio:2.79.0/niocore/bytebuffer'><pre><code><span class='xk'>struct</span> <span class='xv'>ByteBuffer</span></code></pre><p><code>ByteBuffer</code> stores contiguously allocated raw bytes. It is a random and sequential accessible sequence of zero or more bytes (octets).</p></a><a href='/docs/swift/swift/string'><pre><code><span class='xa'>@frozen</span> <span class='xk'>struct</span> <span class='xv'>String</span></code></pre><p>A Unicode string value that is a collection of characters.</p></a><a href='/hist/swift-nio:2.79.0/niocore/eventloopfuture'><pre><code><span class='xk'>final</span> <span class='xk'>class</span> <span class='xv'>EventLoopFuture</span>&lt;<span class='xu'>Value</span>&gt;</code></pre><p>Holder for a result that will be provided later.</p></a><a href='/hist/swift-nio:2.79.0/niocore/channel'><pre><code><span class='xk'>protocol</span> <span class='xv'>Channel</span> : <span class='xt'>AnyObject</span>, <span class='xt'>ChannelOutboundInvoker</span>, <span class='xt'>_NIOPreconcurrencySendable</span></code></pre><p>A <code>Channel</code> is easiest thought of as a network socket. But it can be anything that is capable of I/O operations such as read, write, connect, and bind.</p></a><a href='/hist/swift-nio:2.79.0/niocore/eventloopfuture.flatmapthrowing(_:)'><pre><code><span class='xa'>@preconcurrency</span> <span class='xk'>func</span> <span class='xv'>flatMapThrowing</span>&lt;<span class='xu'>NewValue</span>&gt;(<span class='xi'></span>_ <span class='xb'>callback</span>: <span class='xa'>@escaping</span> (<span class='xt'>Value</span>) <span class='xk'>throws</span> -&gt; <span class='xt'>NewValue</span><wbr>) -&gt; <span class='xt'>EventLoopFuture</span>&lt;<span class='xt'>NewValue</span>&gt;</code></pre><p>When the current <code>EventLoopFuture&lt;Value&gt;</code> is fulfilled, run the provided callback, which performs a synchronous computation and returns a new value of type <code>NewValue</code>. The provided callback may optionally <code>throw</code>.</p></a><a href='/hist/swift-nio:2.79.0/niocore/nioasyncchannel'><pre><code><span class='xk'>struct</span> <span class='xv'>NIOAsyncChannel</span>&lt;<span class='xu'>Inbound</span>, <span class='xu'>Outbound</span>&gt; <span class='xk'>where</span> <span class='xt'>Inbound</span> : <span class='xt'>Sendable</span>, <span class='xt'>Outbound</span> : <span class='xt'>Sendable</span></code></pre><p>Wraps a NIO <code>Channel</code> object into a form suitable for use in Swift Concurrency.</p></a><a href='/hist/swift-nio:2.79.0/niohttp1/httpclientresponsepart'><pre><code><span class='xk'>typealias</span> <span class='xv'>HTTPClientResponsePart</span> = <span class='xt'>HTTPPart</span>&lt;<span class='xt'>HTTPResponseHead</span>, <span class='xt'>ByteBuffer</span>&gt;</code></pre><p>The components of a HTTP response from the view of a HTTP client.</p></a><a href='/hist/swift-nio:2.79.0/niohttp1/httprequesthead'><pre><code><span class='xk'>struct</span> <span class='xv'>HTTPRequestHead</span></code></pre><p>A representation of the request line and header fields of a HTTP request.</p></a><a href='/hist/swift-nio:2.79.0/niocore/nioasyncchannel.executethenclose(_:)?hash=2G196'><pre><code><span class='xk'>func</span> <span class='xv'>executeThenClose</span>&lt;<span class='xu'>Result</span>&gt;(<span class='xi'></span>_ <span class='xb'>body</span>: (_ <span class='xv'>inbound</span>: <span class='xt'>NIOAsyncChannelInboundStream</span>&lt;<span class='xt'>Inbound</span>&gt;, _ <span class='xv'>outbound</span>: <span class='xt'>NIOAsyncChannelOutboundWriter</span>&lt;<span class='xt'>Outbound</span>&gt;) <span class='xk'>async</span> <span class='xk'>throws</span> -&gt; <span class='xt'>Result</span><wbr>) <span class='xk'>async</span> <span class='xk'>throws</span> -&gt; <span class='xt'>Result</span></code></pre><p>Provides scoped access to the inbound and outbound side of the underlying <code>Channel</code>.</p></a><a href='/hist/swift-nio:2.79.0/niocore/nioasyncchanneloutboundwriter.write(_:)'><pre><code><span class='xk'>func</span> <span class='xv'>write</span>(<span class='xi'></span>_ <span class='xb'>data</span>: <span class='xt'>OutboundOut</span><wbr>) <span class='xk'>async</span> <span class='xk'>throws</span></code></pre><p>Send a write into the <code>ChannelPipeline</code> and flush it right away.</p></a><a href='/hist/swift-nio-extras:1.24.1/niohttptypes/httprequestpart.head(_:)'><pre><code><span class='xk'>case</span> <span class='xv'>head</span>(<span class='xt'>HTTPRequest</span>)</code></pre></a><a href='/docs/swift-http-types/httptypes/httprequest'><pre><code><span class='xk'>struct</span> <span class='xv'>HTTPRequest</span></code></pre><p>An HTTP request message consisting of pseudo header fields and header fields.</p></a><a href='/hist/swift-nio-extras:1.24.1/niohttptypes/httprequestpart.end(_:)'><pre><code><span class='xk'>case</span> <span class='xv'>end</span>(<span class='xt'>HTTPFields</span>?)</code></pre></a><a href='/hist/swift-nio-extras:1.24.1/niohttptypes/httpresponsepart.head(_:)'><pre><code><span class='xk'>case</span> <span class='xv'>head</span>(<span class='xt'>HTTPResponse</span>)</code></pre></a><a href='/hist/swift-nio:2.79.0/niocore/nioasyncchannel.channel'><pre><code><span class='xk'>let</span> <span class='xv'>channel</span>: <span class='xt'>Channel</span></code></pre><p>The underlying channel being wrapped by this <code>NIOAsyncChannel</code>.</p></a><a href='/hist/swift-nio:2.79.0/niocore/channel.allocator'><pre><code><span class='xk'>var</span> <span class='xv'>allocator</span>: <span class='xt'>ByteBufferAllocator</span> { <span class='xk'>get</span> }</code></pre><p>The <code>Channel</code>’s <code>ByteBuffer</code> allocator. This is <em>the only</em> supported way of allocating <code>ByteBuffer</code>s to be used with this <code>Channel</code>.</p></a><a href='/hist/swift-nio:2.79.0/niocore/bytebufferallocator.buffer(capacity:)'><pre><code><span class='xk'>func</span> <span class='xv'>buffer</span>(<span class='xi'></span><span class='xv'>capacity</span>: <span class='xt'>Int</span><wbr>) -&gt; <span class='xt'>ByteBuffer</span></code></pre><p>Request a freshly allocated <code>ByteBuffer</code> of size <code>capacity</code> or larger.</p></a><a href='/hist/swift-nio-extras:1.24.1/niohttptypes/httpresponsepart.body(_:)'><pre><code><span class='xk'>case</span> <span class='xv'>body</span>(<span class='xt'>ByteBuffer</span>)</code></pre></a><a href='/hist/swift-nio:2.79.0/niocore/bytebuffer.writeimmutablebuffer(_:)'><pre><code><span class='xa'>@discardableResult</span> <span class='xk'>mutating</span> <span class='xk'>func</span> <span class='xv'>writeImmutableBuffer</span>(<span class='xi'></span>_ <span class='xb'>buffer</span>: <span class='xt'>ByteBuffer</span><wbr>) -&gt; <span class='xt'>Int</span></code></pre></a><a href='/hist/swift-nio-extras:1.24.1/niohttptypes/httpresponsepart.end(_:)'><pre><code><span class='xk'>case</span> <span class='xv'>end</span>(<span class='xt'>HTTPFields</span>?)</code></pre></a><a href='/docs/swift/swift.print(_:separator:terminator:)'><pre><code><span class='xk'>func</span> <span class='xv'>print</span>(<span class='xi'></span>_ <span class='xb'>items</span>: <span class='xk'>Any</span>..., <span class='xi'></span><span class='xv'>separator</span>: <span class='xt'>String</span> = <span class='xs'>" "</span>, <span class='xi'></span><span class='xv'>terminator</span>: <span class='xt'>String</span> = <span class='xs'>"\n"</span><wbr>)</code></pre><p>Writes the textual representations of the given items into the standard output.</p></a><a href='/hist/swift-nio:2.79.0/niocore/bytebuffer.getstring(at:length:)'><pre><code><span class='xk'>func</span> <span class='xv'>getString</span>(<span class='xi'></span><span class='xv'>at</span> <span class='xb'>index</span>: <span class='xt'>Int</span>, <span class='xi'></span><span class='xv'>length</span>: <span class='xt'>Int</span><wbr>) -&gt; <span class='xt'>String</span>?</code></pre><p>Get the string at <code>index</code> from this <code>ByteBuffer</code> decoding using the UTF-8 encoding. Does not move the reader index. The selected bytes must be readable or else <code>nil</code> will be returned.</p></a><a href='/hist/swift-nio:2.79.0/niocore/bytebuffer.readablebytes'><pre><code><span class='xk'>var</span> <span class='xv'>readableBytes</span>: <span class='xt'>Int</span> { <span class='xk'>get</span> }</code></pre><p>The number of bytes readable (<code>readableBytes</code> = <code>writerIndex</code> - <code>readerIndex</code>).</p></a></div>
                    
                </section>
    
                <footer>
                    <br>
                    <time datetime=""></time>
    
                    
                    <div class="author-list">
                        <a href="https://swiftonserver.com/authors/joannis-orlandos/">
                        <img class="small rounded" src="https://swiftonserver.com/assets/authors/joannis-orlandos/joannis-orlandos.jpeg" alt="Joannis Orlandos">
                        <span class="name">Joannis Orlandos</span>
                        </a>
                    </div>
                    <div class="tag-list">
                        <a href="https://swiftonserver.com/tags/networking/"><small>Networking</small></a>
                    <a href="https://swiftonserver.com/tags/swiftnio/"><small>SwiftNIO</small></a>
                    </div>
                </footer>
                            
                <section class="group">
                    <h4>Related posts</h4>                
                    <div class="grid grid-221">
                        <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://swiftonserver.com/authors/tibor-bodecs/">
                                <img class="small rounded" src="https://swiftonserver.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor Bödecs">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2024-10-22">2024-10-22</time>
                                    &middot; <span class="reading-time">10 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://swiftonserver.com/beginners-guide-to-protocol-buffers-and-grpc-with-swift/" target="">Beginner&#39;s Guide to Protocol Buffers and gRPC with Swift</a></h2>
                            <p>Learn Protocol Buffers and gRPC with Swift in this easy, step-by-step beginner&#39;s guide.</p>
                        
                            <div class="spacer"></div>
                        
                            <div class="tag-list">
                                <a href="https://swiftonserver.com/tags/networking/"><small>Networking</small></a>
        <a href="https://swiftonserver.com/tags/package-highlight/"><small>Package Highlight</small></a>
        <a href="https://swiftonserver.com/tags/server/"><small>Server</small></a>
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://swiftonserver.com/authors/joannis-orlandos/">
                                <img class="small rounded" src="https://swiftonserver.com/assets/authors/joannis-orlandos/joannis-orlandos.jpeg" alt="Joannis Orlandos">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2024-08-29">2024-08-29</time>
                                    &middot; <span class="reading-time">5 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://swiftonserver.com/working-with-udp-in-swiftnio/" target="">Working with UDP in SwiftNIO</a></h2>
                            <p>Create UDP servers and clients using SwiftNIO and structured concurrency</p>
                        
                            <div class="spacer"></div>
                        
                            <div class="tag-list">
                                <a href="https://swiftonserver.com/tags/networking/"><small>Networking</small></a>
        <a href="https://swiftonserver.com/tags/server/"><small>Server</small></a>
        <a href="https://swiftonserver.com/tags/swiftnio/"><small>SwiftNIO</small></a>
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://swiftonserver.com/authors/tibor-bodecs/">
                                <img class="small rounded" src="https://swiftonserver.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor Bödecs">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2024-04-03">2024-04-03</time>
                                    &middot; <span class="reading-time">13 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://swiftonserver.com/async-http-client-by-example/" target="">AsyncHTTPClient by example</a></h2>
                            <p>This article offers practical examples to introduce the Swift AsyncHTTPClient library.</p>
                        
                            <div class="spacer"></div>
                        
                            <div class="tag-list">
                                <a href="https://swiftonserver.com/tags/networking/"><small>Networking</small></a>
        <a href="https://swiftonserver.com/tags/package-highlight/"><small>Package Highlight</small></a>
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://swiftonserver.com/authors/joannis-orlandos/">
                                <img class="small rounded" src="https://swiftonserver.com/assets/authors/joannis-orlandos/joannis-orlandos.jpeg" alt="Joannis Orlandos">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2024-02-20">2024-02-20</time>
                                    &middot; <span class="reading-time">11 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://swiftonserver.com/building-swiftnio-clients/" target="">Building an HTTP client using SwiftNIO</a></h2>
                            <p>Learn how to build a simple HTTP client using SwiftNIO and structured concurrency.</p>
                        
                            <div class="spacer"></div>
                        
                            <div class="tag-list">
                                <a href="https://swiftonserver.com/tags/networking/"><small>Networking</small></a>
        <a href="https://swiftonserver.com/tags/swiftnio/"><small>SwiftNIO</small></a>
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://swiftonserver.com/authors/joannis-orlandos/">
                                <img class="small rounded" src="https://swiftonserver.com/assets/authors/joannis-orlandos/joannis-orlandos.jpeg" alt="Joannis Orlandos">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2024-02-08">2024-02-08</time>
                                    &middot; <span class="reading-time">11 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://swiftonserver.com/using-swiftnio-channels/" target="">Using SwiftNIO - Channels</a></h2>
                            <p>Create a TCP server using SwiftNIO and structured concurrency</p>
                        
                            <div class="spacer"></div>
                        
                            <div class="tag-list">
                                <a href="https://swiftonserver.com/tags/networking/"><small>Networking</small></a>
        <a href="https://swiftonserver.com/tags/server/"><small>Server</small></a>
        <a href="https://swiftonserver.com/tags/swiftnio/"><small>SwiftNIO</small></a>
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://swiftonserver.com/authors/joannis-orlandos/">
                                <img class="small rounded" src="https://swiftonserver.com/assets/authors/joannis-orlandos/joannis-orlandos.jpeg" alt="Joannis Orlandos">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2024-01-30">2024-01-30</time>
                                    &middot; <span class="reading-time">5 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://swiftonserver.com/using-swiftnio-fundamentals/" target="">Using SwiftNIO - Fundamentals</a></h2>
                            <p>Learn the fundamental concepts of SwiftNIO, such as EventLoops and nonblocking I/O</p>
                        
                            <div class="spacer"></div>
                        
                            <div class="tag-list">
                                <a href="https://swiftonserver.com/tags/swiftnio/"><small>SwiftNIO</small></a>
                            </div>
                        </div>
                    </div>
                </section>
    
            </article>
        </div>
        
        <div>
            <div class="support">
                <a href="https://www.serversideswift.info/" target="_blank">
                    <img src="https://swiftonserver.com/images/logos/serversideswift.png" alt="ServerSide.swift logo">
                </a>
                <h4>
                    <a href="https://www.serversideswift.info/" target="_blank">ServerSide.swift</a>
                </h4>
                <p>
                    <b>Server-Side Swift Conference</b>
                    <br>
                    2nd-3rd October 2025. London, UK
                </p>
                <a class="cta" href="https://www.serversideswift.info/tickets/" target="_blank">Get Tickets</a>
            </div>
            
            <aside id="toc">
                <h4>On this page</h4>
                <ul>
                    <li class="first-level">
                        <a href="#">Note</a>
                        <ul>
                        </ul>
                    </li>
        <li class="first-level">
                        <a href="#Creating%20a%20Client%20Channel">Creating a Client Channel</a>
                        <ul>
                        </ul>
                    </li>
        <li class="first-level">
                        <a href="#Creating%20Types">Creating Types</a>
                        <ul>
                        </ul>
                    </li>
        <li class="first-level">
                        <a href="#Implementing%20the%20HTTP%20Client">Implementing the HTTP Client</a>
                        <ul>
                        </ul>
                    </li>
        <li class="first-level">
                        <a href="#Sending%20a%20Request">Sending a Request</a>
                        <ul>
                        </ul>
                    </li>
        <li class="first-level">
                        <a href="#Using%20the%20Client">Using the Client</a>
                        <ul>
                        </ul>
                    </li>
                </ul>
            </aside>
    
        </div>
    </div>
    
    </main>

    <footer id="site-footer">
        <div class="grid grid-421">
    
            <figure>
                <picture>
                    <source
                        srcset="https://swiftonserver.com/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="https://swiftonserver.com/images/logos/logo.png"
                        alt="Logo of Swift on server"
                        title="Swift on server"
                    >
                </picture>
            </figure>
            
            <div>
                <span style="display: block; height: 32px;">&nbsp;</span>
                <h4>Swift on server</h4>
                <p><small><a href="/" target="_blank">swiftonserver.com</a></small></p>
                <ul>
                    <li><a href="https://github.com/swift-on-server/" target="_blank">GitHub</a></li>
                    <li><a href="https://mastodon.social/@swiftonserver/" target="_blank">Mastodon</a></li>
                    <li><a href="/rss.xml" target="_blank">RSS</a></li>
                    <li><a href="/sitemap.xml" target="_blank">Sitemap</a></li>
                </ul>
            </div>
            
            <div>
                <a href="/authors/joannis-orlandos/">
                <img class="small rounded" src="https://swiftonserver.com/assets/authors/joannis-orlandos/joannis-orlandos.jpeg" alt="Joannis Orlandos">
                </a>
                <h4><a href="/authors/joannis-orlandos/">Joannis Orlandos</a></h4>
                <p><small><a href="https://unbeatable.software/" target="_blank">Unbeatable Software B.V.</a></small></p>
                <ul>
                    <li><a href="mailto:hello@unbeatable.software" target="_blank">Email</a></li>
                    <li><a href="https://github.com/Joannis" target="_blank">GitHub</a></li>
                    <li><a href="https://x.com/JoannisOrlandos" target="_blank">X (Twitter)</a></li>
                    <li><a href="https://mastodon.social/@joannis@fosstodon.org" target="_blank">Mastodon</a></li>
                </ul>
            </div>
            
            <div>
                <a href="/authors/tibor-bodecs/">
                <img class="small rounded" src="https://swiftonserver.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor Bödecs">
                </a>
                <h4><a href="/authors/tibor-bodecs/">Tibor Bödecs</a></h4>
                <p><small><a href="https://binarybirds.com/" target="_blank">Binary Birds Kft.</a></small></p>
                <ul>
                    <li><a href="mailto:mail.tib@gmail.com" target="_blank">Email</a></li>
                    <li><a href="https://github.com/tib/" target="_blank">GitHub</a></li>
                    <li><a href="https://x.com/tiborbodecs" target="_blank">X (Twitter)</a></li>
                    <li><a href="https://mastodon.social/@tiborbodecs" target="_blank">Mastodon</a></li>
                </ul>
            </div>
            
        </div>
        
        <section class="grid grid-221">
            <small>Swift on server &copy; 2022 - 2025</small>
            <small>This site was generated using <a href="https://swift.org/" target="_blank">Swift</a> & <a href="https://github.com/binarybirds/toucan" target="_blank">Toucan</a>.</small>
        </section>
    </footer>

    </div>

    

    <script type="text/javascript" src="/js/tooltips.js" async=""></script>
</body>
</html>
